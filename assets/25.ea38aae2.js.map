{"version":3,"file":"25.ea38aae2.js","mappings":"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","sources":["webpack:///../components/repl/components/iframe-swap.marko","webpack:///../components/repl/components/preview.marko"],"sourcesContent":["<attrs/iframeAttrs/>\n\n<iframe/first ...iframeAttrs/>\n<iframe/second ...iframeAttrs style=\"display:none\"/>\n\n<return={\n  next() {\n    const firstHidden = first().style.display === \"none\";\n    return firstHidden ? first() : second();\n  },\n  swap() {\n    const firstHidden = first().style.display === \"none\";\n    const current = firstHidden ? second() : first();\n    const next = firstHidden ? first() : second();\n    current.srcdoc = current.srcdoc;\n    current.style.display = \"none\";\n    next.style.display = \"\";\n    return next;\n  }\n}/>","import path from \"path\"\nimport { format } from \"prettier/standalone\"\nimport prettierHTML from \"prettier/parser-html\"\nimport prettierBabel from \"prettier/parser-babel\"\nimport highlight from \"../../../utils/highlight\"\nimport { bundle, compile } from \"../../../utils/compiler\"\nimport fs, { vol } from \"memfs\"\n\n<attrs/{ type, files, selectedFile, getCompilerOptions, debounce, onSelectError, onSyntaxError }/>\n<id/examplePath/>\n<const/selectedPath = path.join(\"/\", examplePath, selectedFile.path)/>\n<const/defaultPath = path.join(\"/\", examplePath, files[0].path)/>\n\n<let/error = null/>\n<let/result = null/>\n<const/SYNTAX_ERROR_REG = /(.+?)(?:\\((\\d+),(\\d+)\\)|:(\\d+)): (.*(?=\\s+\\d+ | ))/ />\n\n<style>\n  .preview-error,\n  .preview-output,\n  .preview-compiled {\n    position: relative;\n    display: block;\n    min-height: 100%;\n    width: 100%;\n    padding-top: 8px;\n    padding-left: 16px;\n  }\n\n  .preview-error {\n    display:none;\n  }\n  .preview-error.preview-error-active {\n    display:block;\n  }\n  \n  .preview-error-active ~ .preview-output,\n  .preview-error-active ~ .preview-compiled {\n    display: none;\n  }\n\n  .preview-compiled {\n    background: #202134;\n  }\n\n  .preview-output {\n    padding: 0;\n    border: 0;\n  }\n\n  .preview-output,\n  .preview-error {\n    background: #fff;\n  }\n  .preview-compiled pre.highlighted {\n    padding: 0;\n    font-family: Menlo, Monaco, \"Courier New\", monospace;\n    font-weight: normal;\n    font-size: 12px;\n    font-feature-settings: \"liga\" 0, \"calt\" 0;\n    line-height: 18px;\n    letter-spacing: 0px;\n  }\n\n  .preview-error .error-name {\n    background: #f92672;\n    color: #f8f8f0;\n    margin-left: -16px;\n    margin-top: -8px;\n    padding-top: 8px;\n    padding-bottom: 12px;\n    padding-left: 16px;\n    font-size: 1.2rem;\n    font-weight: bold;\n    margin-bottom: 8px;\n  }\n\n  .preview-error a {\n    color: #66d9ef;\n    font-weight: normal;\n  }\n\n  .preview-error pre {\n    width: 100%;\n    overflow: auto;\n  }\n\n  .preview-error small {\n    font-style: italic;\n    font-size: 0.75 rem;\n  }\n</style>\n\n\n<div.preview-error class=error && \"preview-error-active\">\n  <if=error>\n    <h1.error-name>\n      ${error.name}\n      <if=error.file>\n        &nbsp;:&nbsp;\n        <a onClick() { onSelectError(error) }>\n          ${error.file.slice(1)}(${error.line},${error.column})\n        </a>\n      </if>\n    </h1>\n    <div>${error.message}</div>\n    <if=(selectedPath !== error.file)>\n      <if=error.codeFrame>\n        <pre><code>${error.codeFrame}</code></pre>\n      </if>\n      <else>\n        <small>Open the dev tools to view the full error.</small>\n      </else>\n    </if>\n  </if>\n</div>\n<if=(type === \"preview\")>\n  <iframe-swap/outputEl class=\"preview-output\"/>\n</if>\n<else>\n  <div.preview-compiled>$!{result}</div>\n</else>\n\n<effect() {\n  let syncTimeout, errorTimeout;\n\n  if (debounce) {\n    syncTimeout = setTimeout(showPreview, 100);\n  } else {\n    showPreview();\n  }\n\n  async function showPreview() {\n    for (const file of files) {\n      const filePath = path.join(\"/\", examplePath, file.path);\n      vol.mkdirSync(path.dirname(filePath), { recursive: true });\n      vol.writeFileSync(filePath, file.content);\n    }\n    \n    try {\n      if (type === \"preview\" || type === \"html\") {\n        const bundleResult = await bundle({\n          entry: defaultPath,\n          markoOptions: { \n            output: \"vdom\",\n            ...(getCompilerOptions ? getCompilerOptions() : {})\n          }\n        });\n\n        if (type === \"preview\") {\n          const { contentWindow, contentDocument } = outputEl.next();\n          contentWindow.__INTERNAL_MODULES__ = window.__INTERNAL_MODULES__;\n          const template = (0, contentWindow.eval)(bundleResult.js);\n          const style = contentDocument.createElement(\"style\");\n          style.innerHTML = bundleResult.css;\n          contentDocument.head.appendChild(style);\n\n          if (getCompilerOptions?.().translator) {\n            // new api\n            template.default({}, contentDocument.body);\n          } else {\n            const renderResult = await template.render({});\n            renderResult.appendTo(contentDocument.body);\n          }\n          outputEl.swap();\n        }\n        // else {\n        //   const template = (0, eval)(bundleResult.js);\n        //   const renderResult = await template.render({});\n        //   result = highlight(\n        //     \"html\",\n        //     format(String(renderResult), {\n        //       parser: \"html\",\n        //       plugins: [prettierHTML]\n        //     })\n        //   );\n        // }\n      } else {\n        const output = type.startsWith(\"compiled-html\") ? \"html\" : \"vdom\";\n        debugger;\n        const code = await compile({\n          entry: selectedPath,\n          markoOptions: { \n            output,\n            ...(getCompilerOptions ? getCompilerOptions() : {})\n          }\n        });\n        result = highlight(\n          \"javascript\",\n          format(\n            code.replaceAll(`${examplePath}/`, \"\"),\n            {\n              parser: \"babel\",\n              plugins: [prettierBabel]\n            }\n          )\n        );\n      }\n\n      error = null;\n    } catch (err) {\n      if (debounce) {\n        errorTimeout = setTimeout(showError, 1000);\n      } else {\n        showError();\n      }\n\n      function showError() {\n        const errorWithLocationMatch =\n          err.name === \"SyntaxError\" && SYNTAX_ERROR_REG.exec(err.message);\n        if (errorWithLocationMatch) {\n          let [match, file, line, column, lineOnly, message] = errorWithLocationMatch;\n          if (lineOnly) {\n            line = lineOnly;\n            column = 0;\n          }\n\n          file = path.resolve(file);\n          line = parseInt(line, 10);\n          column = parseInt(column, 10) + 1;\n          const codeFrame = err.message.slice(match.length);\n          const errorData = error = {\n            name: err.name,\n            file,\n            message,\n            line,\n            column,\n            codeFrame\n          };\n\n          if (file === selectedPath && onSyntaxError) {\n            onSyntaxError(errorData);\n          }\n        } else {\n          error = err;\n          console.error(err);\n        }\n      }\n    }\n  }\n  \n  return () => {\n    clearTimeout(syncTimeout);\n    clearTimeout(errorTimeout);\n    try {\n      vol.rmdirSync(examplePath, { recursive: true });\n    } catch (e) {}\n  }\n}/>"],"names":["iframeAttrs","input","first","_createRef","_component","_meta","out","e","_marko_attrs","_extractHandlers","_componentDef","_component2","second","_meta2","_return","next","style","display","swap","firstHidden","current","srcdoc","_end","t","_marko_componentType","_marko_component","_marko_template","Component","_marko_defineComponent","_","_marko_node","_marko_createElement","_marko_registerComponent","onCreate","state","_marko_renderer","_component3","_begin","outputEl","_state","_outputEl_hoisted","type","files","selectedFile","getCompilerOptions","debounce","onSelectError","onSyntaxError","examplePath","elId","selectedPath","path","defaultPath","error","_errorSet","_error","setState","result","_resultSet","_result","SYNTAX_ERROR_REG","be","_marko_class_merge","name","file","d","slice","line","column","ee","message","codeFrame","n","_marko_tag","_instance","renderBody","_nestedComponentDef","_state2","_iframeSwapReturn","_iframeSwap","value","h","_effect","_cache","_cached","syncTimeout","errorTimeout","async","showPreview","filePath","vol","recursive","content","bundleResult","bundle","entry","markoOptions","output","contentWindow","contentDocument","__INTERNAL_MODULES__","window","template","eval","js","createElement","innerHTML","css","head","appendChild","translator","default","body","render","appendTo","startsWith","code","compile","_assign","highlight","format","replaceAll","parser","plugins","prettierBabel","err","showError","errorWithLocationMatch","exec","match","lineOnly","parseInt","length","errorData","console","setTimeout","clearTimeout"],"sourceRoot":""}