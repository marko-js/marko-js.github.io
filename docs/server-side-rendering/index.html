<script src="/assets/598.6b6c14f3.js" async></script><link rel="stylesheet" href="/assets/ff15f5e4.css"><!doctype html><html lang=en><head><meta charset=UTF-8><title>Server-side rendering | Marko</title><link rel=icon type=image/png sizes=32x32 href=/assets/64c1e059.png><meta name=viewport content="width=device-width, initial-scale=1"><meta name=Description content="Marko is a friendly (and fast!) UI library that makes building web apps fun."><script src="/assets/666.69ec9617.js" async></script><script src="/assets/323.5cae14b9.js" async></script><script src="/assets/987.3cddddc8.js" async></script><link rel="stylesheet" href="/assets/e0a25d12.css"></head><body class=docs><!--M#s0-1-0-8--><header data-marko-key="@header s0-1-0-8" class=site-header><div class=content><a href=/ ><img src=/assets/91bc26e5.svg alt="Marko Home" class=site-logo></a><div class=stuff><nav class=site-menu><a href=/docs/getting-started/ >Docs</a><a href=/try-online>Try Online</a><a href=https://github.com/marko-js/marko>GitHub</a><!--M^s0-1-0-8-8 s0-1-0-8 8--><form data-marko='{"onclick":"focus s0-1-0-8-8 false","onsubmit":"search s0-1-0-8-8 false"}' class="site-search search"><img src=/assets/e213de74.png alt><input data-marko='{"onblur":"shrink s0-1-0-8-8 false","onfocus":"grow s0-1-0-8-8 false"}' data-marko-key="@input s0-1-0-8-8" type=search placeholder="search the docs..."></form><!--M/--></nav><button data-marko='{"onclick":"toggleMenu s0-1-0-8 false"}' class=menu>&#9776;</button></div></div></header><!--M/--><!--M#s0-1-0-9--><div data-marko-key="@sidebar s0-1-0-9" class=doc-sidebar><button data-marko='{"onclick":"hide s0-1-0-9 false"}' class=close>&#10005;</button><h1>Marko <!--M^s0-1-0-9-9 s0-1-0-9 9--><select data-marko='{"onchange":"switchVersion s0-1-0-9-9 false"}'><option value=current selected>5.14.2</option><option value=http://marko-v4.github.io/docs/ >4.x</option><option value=http://v3.markojs.com/docs/ >3.x</option><option value=http://marko-v2.github.io/docs/ >2.x</option></select><!--M/--></h1><!--M^s0-1-0-9-10 s0-1-0-9 10--><form data-marko='{"onclick":"focus s0-1-0-9-10 false","onsubmit":"search s0-1-0-9-10 false"}' class="site-search search"><img src=/assets/e213de74.png alt><input data-marko='{"onblur":"shrink s0-1-0-9-10 false","onfocus":"grow s0-1-0-9-10 false"}' data-marko-key="@input s0-1-0-9-10" type=search placeholder="search the docs..."></form><!--M/--><ul class=toc-level0><li class=section><a href=/docs/guides-overview/ >GUIDES</a></li><li><a href=/docs/installing/ >Installing</a></li><li><a href=/docs/getting-started/ >Getting started</a></li><li><a href=/docs/conditionals-and-lists/ >Conditionals and lists</a></li><li><a href=/docs/custom-tags/ >Custom tags</a></li><li><a href=/docs/state/ >State</a></li><li><a href=/docs/styles/ >Styles</a></li><li><a href=/docs/events/ >Events</a></li><li><a href=/docs/body-content/ >Body content</a></li><li><a href=/docs/marko-5-upgrade/ >Marko 5 upgrade</a></li></ul><ul class=toc-level0><li class=section><a href=/docs/tutorials-overview/ >TUTORIALS</a></li><li><a href=/docs/color-picker/ >Color Picker</a></li></ul><ul class=toc-level0><li class=section><a href=/docs/reference-overview/ >REFERENCE</a></li><li><a href=/docs/rendering/ >Rendering</a></li><li><a href=/docs/syntax/ >Syntax</a></li><li><a href=/docs/core-tags/ >Core tags</a></li><li><a href=/docs/class-components/ >Class components</a></li><li><a href=/docs/marko-json/ >marko.json</a></li><li><a href=/docs/compiler/ >Compiler</a></li></ul><ul class=toc-level0><li class=section><a href=/docs/bundler-integrations-overview/ >BUNDLER INTEGRATIONS</a></li><li><a href=/docs/webpack/ >Webpack</a></li><li><a href=/docs/rollup/ >Rollup</a></li><li><a href=/docs/lasso/ >Lasso</a></li></ul><ul class=toc-level0><li class=section><a href=/docs/server-integrations-overview/ >SERVER INTEGRATIONS</a></li><li><a href=/docs/express/ >Express</a></li><li><a href=/docs/koa/ >Koa</a></li><li><a href=/docs/http/ >HTTP</a></li><li><a href=/docs/fastify/ >Fastify</a></li></ul><ul class=toc-level0><li class=section><a href=/docs/tooling-overview/ >TOOLING</a></li><li><a href=/docs/editor-plugins/ >Editor plugins</a></li></ul><ul class=toc-level0><li class=section><a href=/docs/articles-overview/ >ARTICLES</a></li><li><a href=/docs/marko-vs-react/ >Marko vs React</a></li><li><a href=/docs/why-is-marko-fast/ >Why is Marko Fast</a></li><li><a href=/docs/10-awesome-marko-features/ >10 Awesome Marko Features</a></li></ul></div><!--M/--><main class=content><div class=doc-layout><div class=doc-container><div class=doc-content><h1 id=server-side-rendering><a name=server-side-rendering class=anchor href=#server-side-rendering><span class=header-link></span></a>Server-side rendering</h1><p>Marko allows any Marko template/UI component to be rendered on the server or in the browser. A page can be rendered to a <code>Writable</code> stream such as an HTTP response stream as shown below:</p><script>if(localStorage.getItem('markojs-website:syntax') === 'concise'){document.body.classList.add('concise')}</script><pre class=highlighted style=color:#D0D0E0;background-color:#202034><span style=color:#66D9EF;font-style:italic>var</span> <span style=color:#FFFFFF>template</span> <span style=color:#FFFFFF>=</span> <span style=color:#66D9EF>require</span>(<span style=color:#FFF066>"./template"</span>); <span style=color:#8F8F9E>// Import ./template.marko</span>

<span style=color:#66D9EF;font-style:italic>module</span>.<span style=color:#66D9EF;font-style:italic>exports</span> <span style=color:#FFFFFF>=</span> <span style=color:#66D9EF;font-style:italic>function</span> (<span style=color:#FFAC4D;font-style:italic>req</span>, <span style=color:#FFAC4D;font-style:italic>res</span>) {
  <span style=color:#FFFFFF>res</span>.<span style=color:#A6E22E>setHeader</span>(<span style=color:#FFF066>"Content-Type"</span>, <span style=color:#FFF066>"text/html; charset=utf-8"</span>);
  <span style=color:#FFFFFF>template</span>.<span style=color:#A6E22E>render</span>({ name: <span style=color:#FFF066>"Frank"</span> }, <span style=color:#FFFFFF>res</span>);
};
</pre><p>Marko can also provide you with a <code>Readable</code> stream.</p><pre class=highlighted style=color:#D0D0E0;background-color:#202034><span style=color:#66D9EF;font-style:italic>var</span> <span style=color:#FFFFFF>template</span> <span style=color:#FFFFFF>=</span> <span style=color:#66D9EF>require</span>(<span style=color:#FFF066>"./template"</span>); <span style=color:#8F8F9E>// Import ./template.marko</span>

<span style=color:#66D9EF;font-style:italic>module</span>.<span style=color:#66D9EF;font-style:italic>exports</span> <span style=color:#FFFFFF>=</span> <span style=color:#66D9EF;font-style:italic>function</span> (<span style=color:#FFAC4D;font-style:italic>req</span>) {
  <span style=color:#8F8F9E>// Return a Readable stream for someone to do something with:</span>
  <span style=color:#FF4185>return</span> <span style=color:#FFFFFF>template</span>.<span style=color:#A6E22E>stream</span>({ name: <span style=color:#FFF066>"Frank"</span> });
};
</pre><blockquote class=protip><p><strong>ProTip:</strong> Marko also provides server-side framework integrations:</p><ul><li><a href=/docs/express/ >express</a></li><li><a href=/docs/koa/ >koa</a></li><li><a href=/docs/fastify/ >fastify</a></li></ul></blockquote><h2 id=ui-bootstrapping><a name=ui-bootstrapping class=anchor href=#ui-bootstrapping><span class=header-link></span></a>UI Bootstrapping</h2><p>When a page is rendered on the server, additional code is added to the output HTML to allow the UI to instantly boot in the browser. This additional code allows UI components rendered on the server to be mounted in the browser automatically. For each <em>top-level</em> UI component, Marko will serialize the component&#39;s data (including <code>input</code> and <code>state</code> and any properties added to the UI component instance) so that each top-level UI component can be re-rendered and mounted when the page loads in the browser. Only a &quot;partial&quot; re-render is done for each top-level UI component. That is, when doing the partial re-render in the browser, the DOM is not updated and no virtual DOM is actually produced.</p><p>Marko encodes required information into attributes of rendered HTML elements and it also generates <code>&lt;script&gt;</code> tags that will cause UI components to be mounted. The code inside the <code>&lt;script&gt;</code> simply registers UI components and when the Marko runtime finally loads, all of the registered UI components will then be mounted. This allows the Marko runtime to be loaded at anytime without causing JavaScript errors.</p><h2 id=bootstrapping-components><a name=bootstrapping-components class=anchor href=#bootstrapping-components><span class=header-link></span></a>Bootstrapping Components</h2><p>When a server-rendered page loads in the browser it&#39;s possible for marko to automatically detect UI components rendered on the server and create and mount them with the correct <code>state</code> and <code>input</code> in the browser.</p><h3 id=bootstrapping-lasso><a name=bootstrapping-lasso class=anchor href=#bootstrapping-lasso><span class=header-link></span></a>Bootstrapping: Lasso</h3><p>If you are using <a href=https://github.com/lasso-js/lasso>Lasso.js</a> then the bootstrapping will happen automatically as long as the JavaScript bundles for your page are included via the <code>&lt;lasso-body&gt;</code> tag. A typical HTML page structure will be the following:</p><div class=code-block-filename>routes/index/template.marko</div><!--M#s0-1-0-11-4-41--><!--M^s0-1-0-11-4-41-1 s0-1-0-11-4-41 1--><div class=marko-code-block><button data-marko='{"onclick":"changeSyntax s0-1-0-11-4-41-1 false"}' title="Switch Syntax" class=switch-syntax>â‡„</button><div class="code html"><pre class=highlighted style=color:#D0D0E0;background-color:#202034><span style=color:#8F8F9E>&lt;!DOCTYPE html></span>
&lt;<span style=color:#FF4185>html</span> <span style=color:#A6E22E>lang</span><span style=color:#FFFFFF>=</span><span style=color:#FFF066>"en"</span>>
    &lt;<span style=color:#FF4185>head</span>>
        &lt;<span style=color:#FF4185>meta</span> <span style=color:#A6E22E>charset</span><span style=color:#FFFFFF>=</span><span style=color:#FFF066>"UTF-8"</span>>
        &lt;<span style=color:#FF4185>title</span>><span style=color:#FFF066>Marko + Lasso</span>&lt;/<span style=color:#FF4185>title</span>>

<span style=color:#8F8F9E>        &lt;!-- CSS includes --></span>
        &lt;<span style=color:#FF4185>lasso-head</span>/>
    &lt;/<span style=color:#FF4185>head</span>>
    &lt;<span style=color:#FF4185>body</span>>
<span style=color:#8F8F9E>        &lt;!-- Top-level UI component: --></span>
        &lt;<span style=color:#FF4185>app</span>/>

<span style=color:#8F8F9E>        &lt;!-- JS includes --></span>
        &lt;<span style=color:#FF4185>lasso-body</span>/>
    &lt;/<span style=color:#FF4185>body</span>>
&lt;/<span style=color:#FF4185>html</span>>
</pre></div><div class="code concise"><pre class=highlighted style=color:#D0D0E0;background-color:#202034><span style=color:#8F8F9E>&lt;!DOCTYPE html></span>
<span style=color:#FF4185>html</span> <span style=color:#A6E22E>lang</span><span style=color:#FFFFFF>=</span><span style=color:#FFF066>"en"</span>
    <span style=color:#FF4185>head</span>
        <span style=color:#FF4185>meta</span> <span style=color:#A6E22E>charset</span><span style=color:#FFFFFF>=</span><span style=color:#FFF066>"UTF-8"</span>
        <span style=color:#FF4185>title</span> --<span style=color:#FFF066> Marko + Lasso</span>
        <span style=color:#8F8F9E>// CSS includes</span>
        <span style=color:#FF4185>lasso-head</span>
    <span style=color:#FF4185>body</span>
        <span style=color:#8F8F9E>// Top-level UI component:</span>
        <span style=color:#FF4185>app</span>
        <span style=color:#8F8F9E>// JS includes</span>
        <span style=color:#FF4185>lasso-body</span>
</pre></div></div><!--M/--><!--M/--><blockquote class=protip><p><strong>ProTip:</strong> We have provided some sample apps to help you get started with Marko + Lasso</p><ul><li><a href=https://github.com/marko-js/examples/tree/master/examples/lasso-express>marko-lasso</a></li><li><a href=https://github.com/marko-js/examples/tree/master/examples/ui-components-playground>ui-components-playground</a></li></ul></blockquote><h3 id=bootstrapping-non-lasso><a name=bootstrapping-non-lasso class=anchor href=#bootstrapping-non-lasso><span class=header-link></span></a>Bootstrapping: Non-Lasso</h3><p>If a JavaScript module bundler other than Lasso is being used then you will need to add some client-side code to bootstrap your application in the browser by doing the following:</p><ol><li> Load/import/require all of the UI components that were rendered on the server (loading the top-level UI component is typically sufficient)</li><li> Call <code>require(&#39;marko/components&#39;).init()</code></li></ol><p>For example, if <code>client.js</code> is the entry point for your client-side application:</p><div class=code-block-filename>routes/index/client.js</div><pre class=highlighted style=color:#D0D0E0;background-color:#202034><span style=color:#8F8F9E>// Load the top-level UI component:</span>
<span style=color:#66D9EF>require</span>(<span style=color:#FFF066>"./components/app/index"</span>);

<span style=color:#8F8F9E>// Now that all of the JavaScript modules for the UI component have been</span>
<span style=color:#8F8F9E>// loaded and registered we can tell marko to bootstrap/initialize the app</span>

<span style=color:#8F8F9E>// Initialize and mount all of the server-rendered UI components:</span>
<span style=color:#66D9EF>require</span>(<span style=color:#FFF066>"marko/components"</span>).<span style=color:#A6E22E>init</span>();
</pre><blockquote class=protip><p><strong>ProTip:</strong> We have provided some sample apps to help you get started:</p><ul><li><a href=https://github.com/marko-js/examples/tree/master/examples/webpack-express>marko-webpack</a></li></ul></blockquote><h1 id=serialization><a name=serialization class=anchor href=#serialization><span class=header-link></span></a>Serialization</h1><p>For each <em>top-level</em> UI component, Marko will serialize the component&#39;s data (including <code>input</code> and <code>state</code> and any properties added to the UI component instance) down to the browser. You can control which data gets serialized by implementing <a href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/JSON/stringify><code>toJSON</code></a> or by reassigning <code>this.input</code> in the UI component&#39;s <code>onInput(input, out)</code> lifecycle method as shown below:</p><pre class=highlighted style=color:#D0D0E0;background-color:#202034><span style=color:#66D9EF;font-style:italic>class</span> {
    <span style=color:#A6E22E>onInput</span>() {
        <span style=color:#8F8F9E>// Do not serialize any input:</span>
        <span style=color:#FFFFFF>this</span>.<span style=color:#FFFFFF>input</span> <span style=color:#FFFFFF>=</span> <span style=color:#AE81FF>null</span>;

        <span style=color:#8F8F9E>// Serialize a new object instead of the provided input:</span>
        <span style=color:#FFFFFF>this</span>.<span style=color:#FFFFFF>input</span> <span style=color:#FFFFFF>=</span> {
            foo: <span style=color:#FFF066>'bar'</span>
        };
    }
}
</pre><blockquote class=null><p>NOTE: Marko does allow cycles in serialized objects and Duplicate objects will only be serialized once</p></blockquote><h1 id=caveats><a name=caveats class=anchor href=#caveats><span class=header-link></span></a>Caveats</h1><p>There are some caveats associated with rendering a page on the server:</p><ul><li>The UI component data for top-level UI components must be serializable:<ul><li>Only simple objects, numbers, strings, booleans, arrays and <code>Date</code> objects are serializable</li><li>Functions are not serializable</li></ul></li><li>Care should be taken to avoid having Marko serialize too much data</li><li>None of the data in <code>out.global</code> is serialized by default, but this can be changed as shown below</li></ul><h2 id=serializing-globals><a name=serializing-globals class=anchor href=#serializing-globals><span class=header-link></span></a>Serializing globals</h2><p>If there are specific properties on the <code>out.global</code> object that need to be serialized then they must be whitelisted when the top-level page is rendered on the server. For example, to have the <code>out.global.apiKey</code> and the <code>out.global.locale</code> properties serialized you would do the following:</p><pre class=highlighted style=color:#D0D0E0;background-color:#202034><span style=color:#FFFFFF>template</span>.<span style=color:#A6E22E>render</span>(
  {
    $global: {
      serializedGlobals: {
        apiKey: <span style=color:#AE81FF>true</span>,
        locale: <span style=color:#AE81FF>true</span>
      }
    }
  },
  <span style=color:#FFFFFF>res</span>
);
</pre><a href=https://github.com/marko-js/marko/blob/master/packages/marko/docs/server-side-rendering.md class=edit-on-github>EDIT <img src=/assets/62fa77f5.svg></a><h2 id=contributors><a name=contributors class=anchor href=#contributors><span class=header-link></span></a> Contributors</h2><p>Helpful? You can thank these awesome people! You can also <a href=https://github.com/marko-js/marko/blob/master/packages/marko/docs/server-side-rendering.md>edit this doc</a> if you see any issues or want to improve it.</p><div class=contributors><a href=https://github.com/DylanPiercey class=contributor><img src=https://avatars.githubusercontent.com/u/4985201?v=4 class=photo><span class=name>DylanPiercey</span></a><a href=https://github.com/mlrawlings class=contributor><img src=https://avatars.githubusercontent.com/u/1958812?v=4 class=photo><span class=name>mlrawlings</span></a><a href=https://github.com/ryansolid class=contributor><img src=https://avatars.githubusercontent.com/u/2768267?v=4 class=photo><span class=name>ryansolid</span></a><a href=https://github.com/marko-js/marko/blob/master/packages/marko/docs/server-side-rendering.md class="contributor you"><div class=photo><span class=icon>+</span></div><span class=name>You?</span></a></div><footer class="site-footer doc-footer"><a href=https://openjsf.org/  class=openjsf><img src=/assets/f9c991e7.png alt> <span><span class=bold>OpenJS</span>&nbsp;<span class=light>Foundation</span></span></a><div class=separator></div><a href=https://github.com/marko-js/marko/blob/master/LICENSE class=osi><img src=/assets/4dab80b0.png alt> MIT&nbsp;License</a><div class=separator></div><a href=https://github.com/eBay class=ebay><img src=/assets/657b26bd.svg alt=eBay> open&nbsp;source</a></footer></div></div></div></main><script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-66854919-1', 'markojs.com');
    ga('send', 'pageview');
  </script><a href=https://discord.gg/marko target=_blank class=discord-button><img src=/assets/d188bd4b.svg alt="Chat in Marko's Discord Server"></a><script>$MC=(window.$MC||[]).concat({"o":{"l":1,"w":[["s0-1-0-8",0,{}],["s0-1-0-8-8",1,{"class":"search"}],["s0-1-0-9",2,{"currentDoc":"server-side-rendering","toc":"<ul class=\"toc toc-level0\"><li><a href=\"#server-side-rendering\">Server-side rendering\u003C/a><ul class=\"toc toc-level1\"><li><a href=\"#ui-bootstrapping\">UI Bootstrapping\u003C/a>\u003C/li><li><a href=\"#bootstrapping-components\">Bootstrapping Components\u003C/a><ul class=\"toc toc-level2\"><li><a href=\"#bootstrapping-lasso\">Bootstrapping: Lasso\u003C/a>\u003C/li><li><a href=\"#bootstrapping-non-lasso\">Bootstrapping: Non-Lasso\u003C/a>\u003C/li>\u003C/ul>\u003C/li>\u003C/ul>\u003C/li><li><a href=\"#serialization\">Serialization\u003C/a>\u003C/li><li><a href=\"#caveats\">Caveats\u003C/a><ul class=\"toc toc-level1\"><li><a href=\"#serializing-globals\">Serializing globals\u003C/a>\u003C/li>\u003C/ul>\u003C/li>\u003C/ul>"}],["s0-1-0-9-9",3,{}],["s0-1-0-9-10",1,{"class":"search"}],["s0-1-0-11-4-41",4,{"html":"<pre class=highlighted style=color:#D0D0E0;background-color:#202034><span style=color:#8F8F9E>&lt;!DOCTYPE html>\u003C/span>\n&lt;<span style=color:#FF4185>html\u003C/span> <span style=color:#A6E22E>lang\u003C/span><span style=color:#FFFFFF>=\u003C/span><span style=color:#FFF066>\"en\"\u003C/span>>\n    &lt;<span style=color:#FF4185>head\u003C/span>>\n        &lt;<span style=color:#FF4185>meta\u003C/span> <span style=color:#A6E22E>charset\u003C/span><span style=color:#FFFFFF>=\u003C/span><span style=color:#FFF066>\"UTF-8\"\u003C/span>>\n        &lt;<span style=color:#FF4185>title\u003C/span>><span style=color:#FFF066>Marko + Lasso\u003C/span>&lt;/<span style=color:#FF4185>title\u003C/span>>\n\n<span style=color:#8F8F9E>        &lt;!-- CSS includes -->\u003C/span>\n        &lt;<span style=color:#FF4185>lasso-head\u003C/span>/>\n    &lt;/<span style=color:#FF4185>head\u003C/span>>\n    &lt;<span style=color:#FF4185>body\u003C/span>>\n<span style=color:#8F8F9E>        &lt;!-- Top-level UI component: -->\u003C/span>\n        &lt;<span style=color:#FF4185>app\u003C/span>/>\n\n<span style=color:#8F8F9E>        &lt;!-- JS includes -->\u003C/span>\n        &lt;<span style=color:#FF4185>lasso-body\u003C/span>/>\n    &lt;/<span style=color:#FF4185>body\u003C/span>>\n&lt;/<span style=color:#FF4185>html\u003C/span>>\n\u003C/pre>","concise":"<pre class=highlighted style=color:#D0D0E0;background-color:#202034><span style=color:#8F8F9E>&lt;!DOCTYPE html>\u003C/span>\n<span style=color:#FF4185>html\u003C/span> <span style=color:#A6E22E>lang\u003C/span><span style=color:#FFFFFF>=\u003C/span><span style=color:#FFF066>\"en\"\u003C/span>\n    <span style=color:#FF4185>head\u003C/span>\n        <span style=color:#FF4185>meta\u003C/span> <span style=color:#A6E22E>charset\u003C/span><span style=color:#FFFFFF>=\u003C/span><span style=color:#FFF066>\"UTF-8\"\u003C/span>\n        <span style=color:#FF4185>title\u003C/span> --<span style=color:#FFF066> Marko + Lasso\u003C/span>\n        <span style=color:#8F8F9E>// CSS includes\u003C/span>\n        <span style=color:#FF4185>lasso-head\u003C/span>\n    <span style=color:#FF4185>body\u003C/span>\n        <span style=color:#8F8F9E>// Top-level UI component:\u003C/span>\n        <span style=color:#FF4185>app\u003C/span>\n        <span style=color:#8F8F9E>// JS includes\u003C/span>\n        <span style=color:#FF4185>lasso-body\u003C/span>\n\u003C/pre>"}],["s0-1-0-11-4-41-1",4,null]],"t":["OIKmBXjW","HkYzEWAp","mFesaajv","07hv1F0+","UUumdCIE"]},"$$":[{"l":["w",6,2],"r":["w",5,2]}]})</script></body></html>