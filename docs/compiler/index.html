<script src="/assets/598.6b6c14f3.js" async></script><link rel="stylesheet" href="/assets/ff15f5e4.css"><!doctype html><html lang=en><head><meta charset=UTF-8><title>Compiler | Marko</title><link rel=icon type=image/png sizes=32x32 href=/assets/64c1e059.png><meta name=viewport content="width=device-width, initial-scale=1"><meta name=Description content="Marko is a friendly (and fast!) UI library that makes building web apps fun."><script src="/assets/666.f1112586.js" async></script><script src="/assets/323.2631a76c.js" async></script><script src="/assets/987.6e97928f.js" async></script><link rel="stylesheet" href="/assets/b9cec1ec.css"></head><body class=docs><!--M#s0-1-0-8--><header data-marko-key="@header s0-1-0-8" class=site-header><div class=content><a href=/ ><img src=/assets/91bc26e5.svg alt="Marko Home" class=site-logo></a><div class=stuff><nav class=site-menu><a href=/docs/getting-started/ >Docs</a><a href=/try-online>Try Online</a><a href=https://github.com/marko-js/marko>GitHub</a><!--M^s0-1-0-8-8 s0-1-0-8 8--><form data-marko='{"onclick":"focus s0-1-0-8-8 false","onsubmit":"search s0-1-0-8-8 false"}' class="site-search search"><img src=/assets/e213de74.png alt><input data-marko='{"onblur":"shrink s0-1-0-8-8 false","onfocus":"grow s0-1-0-8-8 false"}' data-marko-key="@input s0-1-0-8-8" type=search placeholder="search the docs..."></form><!--M/--></nav><button data-marko='{"onclick":"toggleMenu s0-1-0-8 false"}' class=menu>&#9776;</button></div></div></header><!--M/--><!--M#s0-1-0-9--><div data-marko-key="@sidebar s0-1-0-9" class=doc-sidebar><button data-marko='{"onclick":"hide s0-1-0-9 false"}' class=close>&#10005;</button><h1>Marko <!--M^s0-1-0-9-9 s0-1-0-9 9--><select data-marko='{"onchange":"switchVersion s0-1-0-9-9 false"}'><option value=current selected>5.18.2</option><option value=http://marko-v4.github.io/docs/ >4.x</option><option value=http://v3.markojs.com/docs/ >3.x</option><option value=http://marko-v2.github.io/docs/ >2.x</option></select><!--M/--></h1><!--M^s0-1-0-9-10 s0-1-0-9 10--><form data-marko='{"onclick":"focus s0-1-0-9-10 false","onsubmit":"search s0-1-0-9-10 false"}' class="site-search search"><img src=/assets/e213de74.png alt><input data-marko='{"onblur":"shrink s0-1-0-9-10 false","onfocus":"grow s0-1-0-9-10 false"}' data-marko-key="@input s0-1-0-9-10" type=search placeholder="search the docs..."></form><!--M/--><ul class=toc-level0><li class=section><a href=/docs/guides-overview/ >GUIDES</a></li><li><a href=/docs/installing/ >Installing</a></li><li><a href=/docs/getting-started/ >Getting started</a></li><li><a href=/docs/conditionals-and-lists/ >Conditionals and lists</a></li><li><a href=/docs/custom-tags/ >Custom tags</a></li><li><a href=/docs/state/ >State</a></li><li><a href=/docs/styles/ >Styles</a></li><li><a href=/docs/events/ >Events</a></li><li><a href=/docs/body-content/ >Body content</a></li><li><a href=/docs/marko-5-upgrade/ >Marko 5 upgrade</a></li><li><a href=/docs/troubleshooting-streaming/ >Troubleshooting Streaming</a></li></ul><ul class=toc-level0><li class=section><a href=/docs/tutorials-overview/ >TUTORIALS</a></li><li><a href=/docs/color-picker/ >Color Picker</a></li></ul><ul class=toc-level0><li class=section><a href=/docs/reference-overview/ >REFERENCE</a></li><li><a href=/docs/rendering/ >Rendering</a></li><li><a href=/docs/syntax/ >Syntax</a></li><li><a href=/docs/core-tags/ >Core tags</a></li><li><a href=/docs/class-components/ >Class components</a></li><li><a href=/docs/marko-json/ >marko.json</a></li><li><a class=selected href=/docs/compiler/ >Compiler</a><ul class="toc toc-level1"><li><a href="#compile-api">Compile API</a><ul class="toc toc-level2"><li><a href="#compile-functions">Compile Functions</a><ul class="toc toc-level3"><li><a href="#compilercompilefilefilename-string-options-compileoptions-promisecompileresult">compiler.compileFile(): Promise&lt;CompileResult&gt;</a></li><li><a href="#compilercompilefilesyncfilename-string-options-compileoptions-compileresult">compiler.compileFileSync(): CompileResult</a></li><li><a href="#compilercompilesrc-string-filename-string-options-compileoptions-promisecompileresult">compiler.compile(): Promise&lt;CompileResult&gt;</a></li><li><a href="#compilercompilesyncsrc-string-filename-string-options-compileoptions-compileresult">compiler.compileSync(): CompileResult</a></li></ul></li><li><a href="#options">Options</a><ul class="toc toc-level3"><li><a href="#output">output</a></li><li><a href="#code">code</a></li><li><a href="#ast">ast</a></li><li><a href="#runtimeid">runtimeId</a></li><li><a href="#writeversioncomment">writeVersionComment</a></li><li><a href="#ignoreunrecognizedtags">ignoreUnrecognizedTags</a></li><li><a href="#sourcemaps">sourceMaps</a></li><li><a href="#meta">meta</a></li><li><a href="#filesystem">fileSystem</a></li><li><a href="#modules">modules</a></li><li><a href="#optimize">optimize</a></li><li><a href="#resolvevirtualdependency">resolveVirtualDependency</a><ul class="toc toc-level4"><li><a href="#example-based-on-markowebpackloader">Example based on @marko/webpack/loader:</a></li></ul></li><li><a href="#hydrateincludeimports">hydrateIncludeImports</a></li><li><a href="#cache">cache</a></li><li><a href="#babelconfig">babelConfig</a></li><li><a href="#translator">translator</a></li></ul></li></ul></li><li><a href="#hooks">Hooks</a><ul class="toc toc-level2"><li><a href="#parse">Parse</a></li><li><a href="#migrate">Migrate</a></li><li><a href="#transform">Transform</a></li><li><a href="#translate">Translate</a></li></ul></li><li><a href="#utilities">Utilities</a></li><li><a href="#marko-ast">Marko AST</a></li></ul></li></ul><ul class=toc-level0><li class=section><a href=/docs/bundler-integrations-overview/ >BUNDLER INTEGRATIONS</a></li><li><a href=/docs/vite/ >Vite</a></li><li><a href=/docs/webpack/ >Webpack</a></li><li><a href=/docs/rollup/ >Rollup</a></li><li><a href=/docs/lasso/ >Lasso</a></li></ul><ul class=toc-level0><li class=section><a href=/docs/server-integrations-overview/ >SERVER INTEGRATIONS</a></li><li><a href=/docs/cloudflare-workers/ >Cloudflare Workers</a></li><li><a href=/docs/express/ >Express</a></li><li><a href=/docs/fastify/ >Fastify</a></li><li><a href=/docs/koa/ >Koa</a></li><li><a href=/docs/http/ >HTTP</a></li></ul><ul class=toc-level0><li class=section><a href=/docs/tooling-overview/ >TOOLING</a></li><li><a href=/docs/editor-plugins/ >Editor plugins</a></li></ul><ul class=toc-level0><li class=section><a href=/docs/articles-overview/ >ARTICLES</a></li><li><a href=/docs/marko-vs-react/ >Marko vs React</a></li><li><a href=/docs/why-is-marko-fast/ >Why is Marko Fast</a></li><li><a href=/docs/10-awesome-marko-features/ >10 Awesome Marko Features</a></li></ul></div><!--M/--><main class=content><div class=doc-layout><div class=doc-container><div class=doc-content><h1 id=compiler><a name=compiler class=anchor href=#compiler><span class=header-link></span></a>Compiler</h1><blockquote class=note><p><strong>Note:</strong> The compiler is an advanced API intended for integrating with build tools (webpack, rollup, etc.) and experimenting with new language features in userland. It&#39;s best to use existing official plugins and the standard tag library when possible.</p></blockquote><h2 id=compile-api><a name=compile-api class=anchor href=#compile-api><span class=header-link></span></a>Compile API</h2><h3 id=compile-functions><a name=compile-functions class=anchor href=#compile-functions><span class=header-link></span></a>Compile Functions</h3><p>The compile functions take an input Marko template <a href=#options><code>CompileOptions</code></a>and produce a <code>CompileResult</code> containing the executable JavaScript:</p><script>if(localStorage.getItem('markojs-website:syntax') === 'concise'){document.body.classList.add('concise')}</script><pre class=highlighted style=color:#D0D0E0;background-color:#202034>type CompileResult = {
  meta: Record&lt;string, unknown>; // Meta data gathered while compiling
  map?: SourceMap; // A sourcemap
  code: string; // The translated code
};
</pre><h4 id=compilercompilefilefilename-string-options-compileoptions-promisecompileresult><a name=compilercompilefilefilename-string-options-compileoptions-promisecompileresult class=anchor href=#compilercompilefilefilename-string-options-compileoptions-promisecompileresult><span class=header-link></span></a><code>compiler.compileFile(filename: string, options?: CompileOptions): Promise&lt;CompileResult&gt;</code></h4><h4 id=compilercompilefilesyncfilename-string-options-compileoptions-compileresult><a name=compilercompilefilesyncfilename-string-options-compileoptions-compileresult class=anchor href=#compilercompilefilesyncfilename-string-options-compileoptions-compileresult><span class=header-link></span></a><code>compiler.compileFileSync(filename: string, options?: CompileOptions): CompileResult</code></h4><p><code>compileFile</code> and <code>compileFileSync</code> load the source template at <code>filename</code> from disk and translate it into JavaScript.</p><pre class=highlighted style=color:#D0D0E0;background-color:#202034><span style=color:#FF4185>import</span> <span style=color:#AE81FF>*</span> <span style=color:#FF4185>as</span> <span style=color:#FFFFFF>compiler</span> <span style=color:#FF4185>from</span> <span style=color:#FFF066>"@marko/compiler"</span>;

<span style=color:#66D9EF>const</span> <span style=color:#FFFFFF>asyncResult</span> <span style=color:#FFFFFF>=</span> <span style=color:#FF4185>await</span> <span style=color:#FFFFFF>compiler</span>.<span style=color:#A6E22E>compileFile</span>(<span style=color:#FFF066>"./src/index.marko"</span>, {
  modules: <span style=color:#FFF066>"cjs"</span>
});
<span style=color:#66D9EF>const</span> <span style=color:#FFFFFF>syncResult</span> <span style=color:#FFFFFF>=</span> <span style=color:#FFFFFF>compiler</span>.<span style=color:#A6E22E>compileFileSync</span>(<span style=color:#FFF066>"./src/index.marko"</span>, {
  modules: <span style=color:#FFF066>"cjs"</span>
});
</pre><h4 id=compilercompilesrc-string-filename-string-options-compileoptions-promisecompileresult><a name=compilercompilesrc-string-filename-string-options-compileoptions-promisecompileresult class=anchor href=#compilercompilesrc-string-filename-string-options-compileoptions-promisecompileresult><span class=header-link></span></a><code>compiler.compile(src: string, filename: string, options?: CompileOptions): Promise&lt;CompileResult&gt;</code></h4><h4 id=compilercompilesyncsrc-string-filename-string-options-compileoptions-compileresult><a name=compilercompilesyncsrc-string-filename-string-options-compileoptions-compileresult class=anchor href=#compilercompilesyncsrc-string-filename-string-options-compileoptions-compileresult><span class=header-link></span></a><code>compiler.compileSync(src: string, filename: string, options?: CompileOptions): CompileResult</code></h4><p><code>compile</code> and <code>compileSync</code> allow passing the source template as a string rather than loading from disk. The <code>filename</code> location is used for resolving taglibs and imports, but does not have to actually exist on disk.</p><pre class=highlighted style=color:#D0D0E0;background-color:#202034><span style=color:#FF4185>import</span> <span style=color:#AE81FF>*</span> <span style=color:#FF4185>as</span> <span style=color:#FFFFFF>compiler</span> <span style=color:#FF4185>from</span> <span style=color:#FFF066>"@marko/compiler"</span>;

<span style=color:#66D9EF>const</span> <span style=color:#FFFFFF>asyncResult</span> <span style=color:#FFFFFF>=</span> <span style=color:#FF4185>await</span> <span style=color:#FFFFFF>compiler</span>.<span style=color:#A6E22E>compile</span>(
  <span style=color:#FFF066>"&lt;h1>Hello!&lt;/>"</span>,
  <span style=color:#FFF066>"./src/index.marko"</span>,
  { modules: <span style=color:#FFF066>"cjs"</span> }
);
<span style=color:#66D9EF>const</span> <span style=color:#FFFFFF>syncResult</span> <span style=color:#FFFFFF>=</span> <span style=color:#FFFFFF>compiler</span>.<span style=color:#A6E22E>compileSync</span>(<span style=color:#FFF066>"&lt;h1>Hello!&lt;/>"</span>, <span style=color:#FFF066>"./src/index.marko"</span>, {
  modules: <span style=color:#FFF066>"cjs"</span>
});
</pre><h3 id=options><a name=options class=anchor href=#options><span class=header-link></span></a>Options</h3><p>Configuration options may be passed when calling the above compile functions or the compiler may be configured globally, overriding the default compiler options:</p><pre class=highlighted style=color:#D0D0E0;background-color:#202034><span style=color:#FF4185>import</span> <span style=color:#AE81FF>*</span> <span style=color:#FF4185>as</span> <span style=color:#FFFFFF>compiler</span> <span style=color:#FF4185>from</span> <span style=color:#FFF066>"@marko/compiler"</span>;
<span style=color:#FFFFFF>compiler</span>.<span style=color:#A6E22E>configure</span>({ output: <span style=color:#FFF066>"dom"</span> });
</pre><h4 id=output><a name=output class=anchor href=#output><span class=header-link></span></a><code>output</code></h4><p>Type: <code>string</code><br> Default: <code>&quot;html&quot;</code></p><ul><li><code>&quot;html&quot;</code> - compiles the template to JavaScript that generates HTML strings.</li><li><code>&quot;dom&quot;</code> - compiles the template to JavaScript that generates DOM nodes.</li><li><code>&quot;hydrate&quot;</code> - similar to DOM, but only includes the assets &amp; components needed in the browser, assuming the page was rendered on the server.</li><li><code>&quot;migrate&quot;</code> - only runs migrations (not transforms or translation) and returns the migrated template code.</li><li><code>&quot;source&quot;</code> - parses Marko file without running any migrations / transforms. (useful with <code>ast: true</code>)</li></ul><p>When using output <code>dom</code> or <code>hydrate</code>, you should also specify a <a href=#resolvevirtualdependency><code>resolveVirtualDependency</code></a> function.</p><h4 id=code><a name=code class=anchor href=#code><span class=header-link></span></a><code>code</code></h4><p>Type: <code>boolean</code><br> Default: true</p><p>If set to false, Marko will not generate the compiled source code string.</p><h4 id=ast><a name=ast class=anchor href=#ast><span class=header-link></span></a><code>ast</code></h4><p>Type: <code>boolean</code><br> Default: false</p><p>Set to true to have the compiler provide the <code>ast</code> in it&#39;s output.</p><h4 id=runtimeid><a name=runtimeid class=anchor href=#runtimeid><span class=header-link></span></a><code>runtimeId</code></h4><p>Type: <code>string</code><br> Default: undefined</p><p>Optionally use to override the runtime id (used to differentiate multiple copies of Marko on the same page) passed to <code>marko/components.init(runtimeId)</code> when compiling in the <code>hydrate</code> output.</p><h4 id=writeversioncomment><a name=writeversioncomment class=anchor href=#writeversioncomment><span class=header-link></span></a><code>writeVersionComment</code></h4><p>Type: <code>boolean</code><br> Default: <code>true</code></p><p>Whether the version should be written to the template as a comment e.g.</p><pre class=highlighted style=color:#D0D0E0;background-color:#202034><span style=color:#8F8F9E>// Compiled using marko@x.x.x - DO NOT EDIT</span>
</pre><h4 id=ignoreunrecognizedtags><a name=ignoreunrecognizedtags class=anchor href=#ignoreunrecognizedtags><span class=header-link></span></a><code>ignoreUnrecognizedTags</code></h4><p>Type: <code>boolean</code><br> Default: <code>false</code></p><p>Whether unrecognized tags should be silently ignored rather than throwing a compile error. The the ignored tag will be output as a native element. Some test setups use this alongside <code>@marko/compiler/taglib</code>&#39;s <code>excludeDir</code> and <code>excludePackage</code> to simulate &quot;shallow&quot; rendering.</p><h4 id=sourcemaps><a name=sourcemaps class=anchor href=#sourcemaps><span class=header-link></span></a><code>sourceMaps</code></h4><p>Type: <code>boolean</code> or <code>string</code><br> Default: <code>false</code></p><p>Whether source maps should be output with the compiled templates.</p><ul><li>When <code>true</code> a <code>map</code> property will be available on the compile result.</li><li>When <code>&quot;inline&quot;</code> the sourcemap will be inlined as a comment in the output code.</li><li>When <code>&quot;both&quot;</code> both of the above will be used.</li></ul><h4 id=meta><a name=meta class=anchor href=#meta><span class=header-link></span></a><code>meta</code></h4><p>Type: <code>boolean</code><br> Default: `false,</p><p><em>Deprecated</em>. This option inlines the metadata in the output Javascript code. Metadata should be accessed instead from the <code>CompileResult</code>.</p><h4 id=filesystem><a name=filesystem class=anchor href=#filesystem><span class=header-link></span></a><code>fileSystem</code></h4><p>Type: typeof <a href=https://nodejs.org/api/fs.html><code>fs</code></a> (specifically read APIs)<br> Default: Cached <code>fs</code></p><p>Use a different file system object (eg. webpack&#39;s <a href=https://github.com/webpack/enhanced-resolve/blob/f08fe3f1a22c90c722eca14b38a9300ad00c62e8/lib/CachedInputFileSystem.js>CachedInputFileSystem</a> or <a href=https://github.com/eBay/arc/tree/master/packages/arc-fs><code>arc-fs</code></a>)</p><h4 id=modules><a name=modules class=anchor href=#modules><span class=header-link></span></a><code>modules</code></h4><p>Type: <code>string</code> (<code>&quot;esm&quot;</code> or <code>&quot;cjs&quot;</code>)<br> Default: <code>&quot;esm&quot;</code></p><p>By default Marko outputs ES Modules, you can optionally specify commonjs.</p><h4 id=optimize><a name=optimize class=anchor href=#optimize><span class=header-link></span></a><code>optimize</code></h4><p>Type: <code>boolean</code><br> Default: <a href=https://github.com/marko-js/marko/blob/0f212897d2d3ec30b12c2f18ba950818bccb83b4/packages/compiler/src/babel-plugin/index.js#L277-L284>environment based</a> (<code>false</code> in development, <code>true</code> in production)</p><p>Enables production mode optimizations</p><h4 id=resolvevirtualdependency><a name=resolvevirtualdependency class=anchor href=#resolvevirtualdependency><span class=header-link></span></a><code>resolveVirtualDependency</code></h4><p>Type:</p><pre class=highlighted style=color:#D0D0E0;background-color:#202034>(
  filename: string,
  dep: {
    code: string;
    virtualPath: string;
    map?: SourceMap;
  }
) => string;
</pre><p>Default: <code>undefined</code></p><p>This option should be set when <code>dom</code> or <code>hydrate</code> output is specified. Since Marko templates can represent multiple output files (eg. JS renderer, CSS styles), we need to be able to treat a single source <code>.marko</code> file as multiple virtual files.</p><p>Different build tools have different mechanisms for handling virtual files. You should pass a function that returns a virtual path that can be handled by your build tool.</p><h5 id=example-based-on-markowebpackloader><a name=example-based-on-markowebpackloader class=anchor href=#example-based-on-markowebpackloader><span class=header-link></span></a>Example based on <code>@marko/webpack/loader</code>:</h5><pre class=highlighted style=color:#D0D0E0;background-color:#202034><span style=color:#8F8F9E>// lookup is shared between resolveVirtualDependency and markoLoader</span>
<span style=color:#66D9EF>const</span> <span style=color:#FFFFFF>virtualSources</span> <span style=color:#FFFFFF>=</span> <span style=color:#FF4185>new</span> Map();

<span style=color:#66D9EF>function</span> <span style=color:#A6E22E>resolveVirtualDependency</span>(<span style=color:#FFAC4D>filename</span>, { <span style=color:#FFAC4D>virtualPath</span>, <span style=color:#FFAC4D>code</span>, <span style=color:#FFAC4D>map</span> }) {
  <span style=color:#66D9EF>const</span> <span style=color:#FFFFFF>virtualFilename</span> <span style=color:#FFFFFF>=</span> <span style=color:#FFF066>`</span><span style=color:#66D9EF>${</span><span style=color:#FFFFFF>filename</span><span style=color:#66D9EF>}</span><span style=color:#FFF066>?virtual=</span><span style=color:#66D9EF>${</span><span style=color:#FFFFFF>virtualPath</span><span style=color:#66D9EF>}</span><span style=color:#FFF066>`</span>;

  <span style=color:#8F8F9E>// Add the virtual source to the lookup</span>
  <span style=color:#8F8F9E>// to be later accessed by the loader</span>
  <span style=color:#FFFFFF>virtualSources</span>.<span style=color:#A6E22E>set</span>(<span style=color:#FFFFFF>virtualFilename</span>, { <span style=color:#FFFFFF>code</span>, <span style=color:#FFFFFF>map</span> });

  <span style=color:#8F8F9E>// Generate the webpack path, from right to left...</span>
  <span style=color:#8F8F9E>// 1. Pass the virtualFilename so webpack can find the real file</span>
  <span style=color:#8F8F9E>//    located at sourceFilename, but the virtualPath is also present</span>
  <span style=color:#8F8F9E>//    (eg. "./index.marko?virtual=./index.marko.css")</span>
  <span style=color:#8F8F9E>// 2. Use an inline loader to run this file through @marko/webpack/loader</span>
  <span style=color:#8F8F9E>//    https://webpack.js.org/concepts/loaders/#inline</span>
  <span style=color:#8F8F9E>// 3. Use an inline matchResource to redefine this as the virtualPath</span>
  <span style=color:#8F8F9E>//    which allows the appropriate loaders to match the virtual dependency</span>
  <span style=color:#8F8F9E>//    https://webpack.js.org/api/loaders/#inline-matchresource</span>
  <span style=color:#FF4185>return</span> <span style=color:#FFF066>`</span><span style=color:#66D9EF>${</span><span style=color:#FFFFFF>virtualPath</span><span style=color:#66D9EF>}</span><span style=color:#FFF066>!=!@marko/webpack/loader!</span><span style=color:#66D9EF>${</span><span style=color:#FFFFFF>virtualFilename</span><span style=color:#66D9EF>}</span><span style=color:#FFF066>`</span>;
}

<span style=color:#FF4185>export</span> <span style=color:#FF4185>default</span> <span style=color:#66D9EF>function</span> <span style=color:#A6E22E>markoLoader</span>(<span style=color:#FFAC4D>source</span>) {
  <span style=color:#66D9EF>let</span> <span style=color:#FFFFFF>code</span>, <span style=color:#FFFFFF>map</span>;

  <span style=color:#FF4185>if</span> (<span style=color:#FFFFFF>virtualSources</span>.<span style=color:#A6E22E>has</span>(<span style=color:#FFFFFF>this</span>.<span style=color:#FFFFFF>resource</span>)) {
    <span style=color:#8F8F9E>// If the resource has a ?virtual query param, we should</span>
    <span style=color:#8F8F9E>// find it in the lookup and then return the virtual code</span>
    <span style=color:#8F8F9E>// rather than performing the normal compilation</span>
    { <span style=color:#FFFFFF>code</span>, <span style=color:#FFFFFF>map</span> } <span style=color:#FFFFFF>=</span> <span style=color:#FFFFFF>virtualSources</span>.<span style=color:#A6E22E>get</span>(<span style=color:#FFFFFF>this</span>.<span style=color:#FFFFFF>resource</span>);
    <span style=color:#FFFFFF>virtualSources</span>.<span style=color:#A6E22E>delete</span>(<span style=color:#FFFFFF>this</span>.<span style=color:#FFFFFF>resource</span>);
  } <span style=color:#FF4185>else</span> {
    <span style=color:#8F8F9E>// The default behavior is to compile the template in dom output mode</span>
    { <span style=color:#FFFFFF>code</span>, <span style=color:#FFFFFF>map</span> } <span style=color:#FFFFFF>=</span> <span style=color:#FFFFFF>markoCompiler</span>.<span style=color:#A6E22E>compileSync</span>(<span style=color:#FFFFFF>source</span>, <span style=color:#FFFFFF>this</span>.<span style=color:#FFFFFF>resourcePath</span>, {
      output: <span style=color:#FFF066>"dom"</span>,
      <span style=color:#FFFFFF>resolveVirtualDependency</span>
    });
  }

  <span style=color:#FF4185>return</span> <span style=color:#FFFFFF>this</span>.<span style=color:#A6E22E>callback</span>(<span style=color:#AE81FF>null</span>, <span style=color:#FFFFFF>code</span>, <span style=color:#FFFFFF>map</span>);
}
</pre><h4 id=hydrateincludeimports><a name=hydrateincludeimports class=anchor href=#hydrateincludeimports><span class=header-link></span></a><code>hydrateIncludeImports</code></h4><p>This option is only used for <code>output: &quot;hydrate&quot;</code>. By default any <code>import</code>&#39;s in server only files are not included in the hydrate output. However for some assets, for example stylesheets, it is useful to have them still be included in hydrate mode.</p><p>The <code>hydrateIncludeImports</code> option allows you to provide a function which receives an import path, or a regexp to match against that path which tells Marko to include that import in the hydrate mode output.</p><p>The default regexp includes a list of common known asset file extensions and is as follows:</p><pre class=highlighted style=color:#D0D0E0;background-color:#202034><span style=color:#FFF066>/</span><span style=color:#AE81FF>\.</span><span style=color:#FFF066>(css</span><span style=color:#FF4185>|</span><span style=color:#FFF066>less</span><span style=color:#FF4185>|</span><span style=color:#FFF066>s</span><span style=color:#AE81FF>[ac]</span><span style=color:#FFF066>ss</span><span style=color:#FF4185>|</span><span style=color:#FFF066>styl</span><span style=color:#FF4185>|</span><span style=color:#FFF066>png</span><span style=color:#FF4185>|</span><span style=color:#FFF066>jpe</span><span style=color:#FF4185>?</span><span style=color:#FFF066>g</span><span style=color:#FF4185>|</span><span style=color:#FFF066>gif</span><span style=color:#FF4185>|</span><span style=color:#FFF066>svg</span><span style=color:#FF4185>|</span><span style=color:#FFF066>ico</span><span style=color:#FF4185>|</span><span style=color:#FFF066>webp</span><span style=color:#FF4185>|</span><span style=color:#FFF066>avif</span><span style=color:#FF4185>|</span><span style=color:#FFF066>mp4</span><span style=color:#FF4185>|</span><span style=color:#FFF066>webm</span><span style=color:#FF4185>|</span><span style=color:#FFF066>ogg</span><span style=color:#FF4185>|</span><span style=color:#FFF066>mp3</span><span style=color:#FF4185>|</span><span style=color:#FFF066>wav</span><span style=color:#FF4185>|</span><span style=color:#FFF066>flac</span><span style=color:#FF4185>|</span><span style=color:#FFF066>aac</span><span style=color:#FF4185>|</span><span style=color:#FFF066>woff2</span><span style=color:#FF4185>?|</span><span style=color:#FFF066>eot</span><span style=color:#FF4185>|</span><span style=color:#FFF066>ttf</span><span style=color:#FF4185>|</span><span style=color:#FFF066>otf)</span><span style=color:#FF4185>$</span><span style=color:#FFF066>/</span>;
</pre><p>Looking at a partial Marko file such as:</p><!--M#s0-1-0-11-4-208-1--><div class=marko-code-block><button data-marko='{"onclick":"changeSyntax s0-1-0-11-4-208-1 false"}' title="Switch Syntax" class=switch-syntax>⇄</button><div class="code html"><pre class=highlighted style=color:#D0D0E0;background-color:#202034><span style=color:#FF4185>import</span> <span style=color:#FFF066>"./bar"</span>
<span style=color:#FF4185>import</span> <span style=color:#FFF066>"./foo.css"</span>;
<span style=color:#FF4185>import</span> <span style=color:#FFF066>"./baz.wasm"</span>;

&lt;<span style=color:#FF4185>div</span>/>
</pre></div><div class="code concise"><pre class=highlighted style=color:#D0D0E0;background-color:#202034><span style=color:#FF4185>import</span> <span style=color:#FFF066>"./bar"</span>;
<span style=color:#FF4185>import</span> <span style=color:#FFF066>"./foo.css"</span>;
<span style=color:#FF4185>import</span> <span style=color:#FFF066>"./baz.wasm"</span>;

<span style=color:#FF4185>div</span>
</pre></div></div><!--M/--><p>In the <code>hydrate</code> output, with the default <code>hydrateIncludeImports</code>, would only cause <code>./foo.css</code> to be loaded in the browser.</p><h4 id=cache><a name=cache class=anchor href=#cache><span class=header-link></span></a><code>cache</code></h4><p>Type: typeof <a href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Map><code>Map</code></a> (specifically, <code>get</code> is required)<br> Default: <code>new Map()</code></p><p>Compiling a Marko template may require other (used) Marko templates to compile. To prevent compiling templates more than once, most of the compilation is cached.</p><p>The default cache strategy is to clear the cache on every macrotask. If the default cache is overwritten it is up to the user to determine when the cache is cleared.</p><h4 id=babelconfig><a name=babelconfig class=anchor href=#babelconfig><span class=header-link></span></a><code>babelConfig</code></h4><p>Type: see <a href=https://babeljs.io/docs/en/options>babel options</a><br> Default: babel defaults, plus</p><pre class=highlighted style=color:#D0D0E0;background-color:#202034>{
  <span style=color:#FFFFFF>filename</span>,
  sourceType: <span style=color:#FFF066>"module"</span>,
  sourceMaps: <span style=color:#FFFFFF>config</span>.<span style=color:#FFFFFF>sourceMaps</span>
}
</pre><h4 id=translator><a name=translator class=anchor href=#translator><span class=header-link></span></a><code>translator</code></h4><p>Type: <code>{ analyze: Visitor, transform:Visitor }</code><br> Default: <a href=https://github.com/marko-js/marko/blob/0f212897d2d3ec30b12c2f18ba950818bccb83b4/packages/compiler/src/config.js#L46-L89>autodiscovers</a> a translator package starting with <code>@marko/translator-</code> or <code>marko-translator-</code></p><p>The translator is a collection of transforms that translates the Marko AST into a valid JavaScript AST based on the <code>output</code> option. There is a default translator that ships with Marko, but this option may be used to switch to experimental translators for alternate runtimes.</p><p>The translator is an object with two <a href=https://github.com/jamiebuilds/babel-handbook/blob/master/translations/en/plugin-handbook.md#visitors>Babel Visitors</a>: <code>analyze</code> and <code>transform</code>. The result of the analyze visitor is cached and may be requested by other templates. The transform visitor transforms the AST to it&#39;s final JavaScript AST.</p><p>See <a href=https://github.com/marko-js/marko/blob/11a10f82cdb5389880e6deca5f77d17727acb831/packages/translator-default/src/index.js><code>@marko/translator-default</code></a> for a reference implementation.</p><h2 id=hooks><a name=hooks class=anchor href=#hooks><span class=header-link></span></a>Hooks</h2><p><img src=/assets/e6d9b930.png alt="Marko compiler hooks" style=max-width:100%></p><p>The Marko compiler runs through a series of stages to produce the final JavaScript output. These stages are intended for different aspects of processing the template and can be hooked into using <a href=/docs/marko-json/ ><code>marko.json</code></a> configuration.</p><p>All compiler hooks must export a visitor which will receive a <a href=https://github.com/jamiebuilds/babel-handbook/blob/master/translations/en/plugin-handbook.md#paths>babel NodePath</a> with a <code>MarkoTag</code> node.</p><p>The hook will also receive a <code>types</code> object that matches the <a href=https://babeljs.io/docs/en/babel-types>@babel/types</a> API extended with the <a href=#marko-ast>Marko AST types</a>. You can also get a reference to this by importing <code>{ types }</code> from the <code>@marko/compiler</code> module.</p><p>Here is an example hook:</p><pre class=highlighted style=color:#D0D0E0;background-color:#202034><span style=color:#66D9EF>module</span>.<span style=color:#66D9EF>exports</span> <span style=color:#FFFFFF>=</span> (<span style=color:#FFAC4D>tag</span>, <span style=color:#FFAC4D>types</span>) <span style=color:#66D9EF>=></span> {
  <span style=color:#FF4185>if</span> (<span style=color:#FFFFFF>types</span>.<span style=color:#A6E22E>isStringLiteral</span>(<span style=color:#FFFFFF>tag</span>.<span style=color:#FFFFFF>node</span>.<span style=color:#FFFFFF>name</span>)) {
    <span style=color:#FFFFFF>console</span>.<span style=color:#A6E22E>log</span>(<span style=color:#FFF066>`Found a tag called </span><span style=color:#66D9EF>${</span><span style=color:#FFFFFF>tag</span><span style=color:#FFF066>.</span><span style=color:#FFFFFF>node</span><span style=color:#FFF066>.</span><span style=color:#FFFFFF>name</span><span style=color:#FFF066>.</span><span style=color:#FFFFFF>value</span><span style=color:#66D9EF>}</span><span style=color:#FFF066>`</span>);
    <span style=color:#FFFFFF>tag</span>.<span style=color:#A6E22E>remove</span>();
  }
};
</pre><p>Hooks can also export an <code>enter</code> (alias of <code>default</code>) and an <code>exit</code> function. These map to <a href=https://github.com/jamiebuilds/babel-handbook/blob/master/translations/en/plugin-handbook.md#babel-traverse>@babel/traverse&#39;s</a> <code>enter</code> and <code>exit</code> methods.</p><h3 id=parse><a name=parse class=anchor href=#parse><span class=header-link></span></a>Parse</h3><p>The first step to Marko&#39;s compilation is to take the raw text of your Marko template and convert it into an &quot;Abstract Syntax Tree&quot;. If you&#39;ve not heard the term before, put simply it is just an object representation of your code.</p><!--M#s0-1-0-11-4-280-1--><div class=marko-code-block><button data-marko='{"onclick":"changeSyntax s0-1-0-11-4-280-1 false"}' title="Switch Syntax" class=switch-syntax>⇄</button><div class="code html"><pre class=highlighted style=color:#D0D0E0;background-color:#202034>&lt;<span style=color:#FF4185>h1</span>>Hello!&lt;/<span style=color:#FF4185>h1</span>>
</pre></div><div class="code concise"><pre class=highlighted style=color:#D0D0E0;background-color:#202034><span style=color:#FF4185>h1</span> -- Hello!
</pre></div></div><!--M/--><p>Will roughly become</p><pre class=highlighted style=color:#D0D0E0;background-color:#202034>{
  <span style=color:#FFF066>"type"</span>: <span style=color:#FFF066>"MarkoTag"</span>,
  <span style=color:#FFF066>"name"</span>: {
    <span style=color:#FFF066>"type"</span>: <span style=color:#FFF066>"StringLiteral"</span>,
    <span style=color:#FFF066>"value"</span>: <span style=color:#FFF066>"h1"</span>
  },
  <span style=color:#FFF066>"body"</span>: {
    <span style=color:#FFF066>"type"</span>: <span style=color:#FFF066>"MarkoTagBody"</span>,
    <span style=color:#FFF066>"body"</span>: [
      {
        <span style=color:#FFF066>"type"</span>: <span style=color:#FFF066>"MarkoText"</span>,
        <span style=color:#FFF066>"value"</span>: <span style=color:#FFF066>"Hello!"</span>
      }
    ]
  }
}
</pre><p>This might look a bit verbose, but we are aiming for completeness, not terseness in this output.</p><p>Marko takes a two-step parsing approach to remain flexible with the ever-changing syntax of JavaScript. The first pass of parsing happens in our very own <a href=https://github.com/marko-js/htmljs-parser>htmljs-parser</a>, which understands the HTML parts of your template.</p><p>For JavaScript expressions, Marko defers to <a href=https://babeljs.io/docs/en/babel-parser>@babel/parser</a>. The <a href=#marko-ast>Marko AST</a> above is a superset of what would be returned from <code>@babel/parser</code>.</p><p>To hook into the <code>parse</code> stage you can use the <code>parse</code> option in the <code>marko.json</code> file. The <code>parse</code> hook deviates from the rest of the compiler hooks in that it does not support the <code>enter</code> &amp; <code>exit</code> API and you <em>must return</em> a replacement AST node.</p><h3 id=migrate><a name=migrate class=anchor href=#migrate><span class=header-link></span></a>Migrate</h3><p>That&#39;s right, Marko has _ first-class_ support for migrations. This compiler hook allows for translating outdated APIs into their modern counterparts, leaving the rest of the compilation non the wiser. These migrations run automatically in the background and can be written to disk when users are ready by running the <a href=https://github.com/marko-js/cli/blob/master/packages/migrate/README.md><code>@marko/migrate</code> CLI command</a>.</p><p>To hook into the <code>migrate</code> stage you can use the <code>migrate</code> option in the <code>marko.json</code> file.</p><blockquote class=note><p><strong>Note:</strong> To make the compiler to stop at this point and output the migrated template rather than continuing on to produce the JavaScript output, pass <code>&quot;migrate&quot;</code> as the value for the <code>output</code> compilation option.</p></blockquote><h3 id=transform><a name=transform class=anchor href=#transform><span class=header-link></span></a>Transform</h3><p>The transform stage of the compiler is meant for userland transformations of Marko code, into other Marko code. Think of it like <a href=https://babeljs.io/docs/en/babel-core#transform>babel.transform</a> for Marko templates. At this stage, you are given a fully parsed and migrated AST to do what you will with.</p><p>To hook into the <code>transform</code> stage you can use the <code>transform</code> option in the <code>marko.json</code> file.</p><h3 id=translate><a name=translate class=anchor href=#translate><span class=header-link></span></a>Translate</h3><p>Finally, we have the translation stage. This stage is Marko&#39;s &quot;Rosetta Stone&quot; and is responsible for turning your beautiful Marko code into the optimized JavaScript you&#39;d rather avoid writing.</p><p>To hook into the <code>translate</code> stage you can use the <code>translate</code> option in the <code>marko.json</code> file.</p><h2 id=utilities><a name=utilities class=anchor href=#utilities><span class=header-link></span></a>Utilities</h2><p>The <a href=https://github.com/marko-js/marko/tree/master/packages/babel-utils/index.d.ts><code>@marko/babel-utils</code></a> package exposes a handful of utilities for performing various tasks on the <a href=#marko-ast>Marko AST</a>.</p><h2 id=marko-ast><a name=marko-ast class=anchor href=#marko-ast><span class=header-link></span></a>Marko AST</h2><p>Marko extends Babel&#39;s AST types adding nodes for <code>MarkoTag</code>, <code>MarkoAttribute</code>, etc. For AST creation and assertion utilities you can import Marko&#39;s superset of <code>@babel/types</code> through the compiler:</p><pre class=highlighted style=color:#D0D0E0;background-color:#202034><span style=color:#FF4185>import</span> { <span style=color:#FFFFFF>types</span> } <span style=color:#FF4185>from</span> <span style=color:#FFF066>"@marko/compiler"</span>;
</pre><p>The <a href=https://babeljs.io/docs/en/babel-types><code>@babel/types</code> documentation</a> shows all the utility methods available for the Babel AST nodes. When importing <code>types</code> from <code>@marko/compiler</code> you get the same types of utilities for the Marko nodes as well (<code>types.markoTag</code>, <code>types.isMarkoTag</code>, <code>types.assertMarkoTag</code>, etc.).</p><p>For a full list of definitions, view the source code for Babel and Marko:</p><ul><li><a href=https://github.com/babel/babel/blob/master/packages/babel-types/src/definitions/core.js>Babel&#39;s Core Definitions</a></li><li><a href=https://github.com/babel/babel/tree/master/packages/babel-types/src/definitions>Babel&#39;s Extended Definitions</a></li><li><a href=https://github.com/marko-js/marko/blob/master/packages/compiler/src/babel-types/types/definitions.js>Marko&#39;s Definitions</a></li></ul><a href=https://github.com/marko-js/marko/blob/master/packages/marko/docs/compiler.md class=edit-on-github>EDIT <img src=/assets/62fa77f5.svg></a><h2 id=contributors><a name=contributors class=anchor href=#contributors><span class=header-link></span></a> Contributors</h2><p>Helpful? You can thank these awesome people! You can also <a href=https://github.com/marko-js/marko/blob/master/packages/marko/docs/compiler.md>edit this doc</a> if you see any issues or want to improve it.</p><div class=contributors><a href=https://github.com/DylanPiercey class=contributor><img src=https://avatars.githubusercontent.com/u/4985201?v=4 class=photo><span class=name>DylanPiercey</span></a><a href=https://github.com/marko-js/marko/blob/master/packages/marko/docs/compiler.md class="contributor you"><div class=photo><span class=icon>+</span></div><span class=name>You?</span></a></div><footer class="site-footer doc-footer"><a href=https://openjsf.org/  class=openjsf><img src=/assets/f9c991e7.png alt> <span><span class=bold>OpenJS</span>&nbsp;<span class=light>Foundation</span></span></a><div class=separator></div><a href=https://github.com/marko-js/marko/blob/master/LICENSE class=osi><img src=/assets/4dab80b0.png alt> MIT&nbsp;License</a><div class=separator></div><a href=https://github.com/eBay class=ebay><img src=/assets/657b26bd.svg alt=eBay> open&nbsp;source</a></footer></div></div></div></main><script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-66854919-1', 'markojs.com');
    ga('send', 'pageview');
  </script><a href=https://discord.gg/marko target=_blank class=discord-button><img src=/assets/8d84725b.svg alt="Chat in Marko's Discord Server"></a><script>$MC=(window.$MC||[]).concat({"l":1,"w":[["s0-1-0-8",0,{}],["s0-1-0-8-8",1,{"class":"search"}],["s0-1-0-9",2,{"currentDoc":"compiler","toc":"<ul class=\"toc toc-level1\"><li><a href=\"#compile-api\">Compile API\u003C/a><ul class=\"toc toc-level2\"><li><a href=\"#compile-functions\">Compile Functions\u003C/a><ul class=\"toc toc-level3\"><li><a href=\"#compilercompilefilefilename-string-options-compileoptions-promisecompileresult\">compiler.compileFile(): Promise&lt;CompileResult&gt;\u003C/a>\u003C/li><li><a href=\"#compilercompilefilesyncfilename-string-options-compileoptions-compileresult\">compiler.compileFileSync(): CompileResult\u003C/a>\u003C/li><li><a href=\"#compilercompilesrc-string-filename-string-options-compileoptions-promisecompileresult\">compiler.compile(): Promise&lt;CompileResult&gt;\u003C/a>\u003C/li><li><a href=\"#compilercompilesyncsrc-string-filename-string-options-compileoptions-compileresult\">compiler.compileSync(): CompileResult\u003C/a>\u003C/li>\u003C/ul>\u003C/li><li><a href=\"#options\">Options\u003C/a><ul class=\"toc toc-level3\"><li><a href=\"#output\">output\u003C/a>\u003C/li><li><a href=\"#code\">code\u003C/a>\u003C/li><li><a href=\"#ast\">ast\u003C/a>\u003C/li><li><a href=\"#runtimeid\">runtimeId\u003C/a>\u003C/li><li><a href=\"#writeversioncomment\">writeVersionComment\u003C/a>\u003C/li><li><a href=\"#ignoreunrecognizedtags\">ignoreUnrecognizedTags\u003C/a>\u003C/li><li><a href=\"#sourcemaps\">sourceMaps\u003C/a>\u003C/li><li><a href=\"#meta\">meta\u003C/a>\u003C/li><li><a href=\"#filesystem\">fileSystem\u003C/a>\u003C/li><li><a href=\"#modules\">modules\u003C/a>\u003C/li><li><a href=\"#optimize\">optimize\u003C/a>\u003C/li><li><a href=\"#resolvevirtualdependency\">resolveVirtualDependency\u003C/a><ul class=\"toc toc-level4\"><li><a href=\"#example-based-on-markowebpackloader\">Example based on @marko/webpack/loader:\u003C/a>\u003C/li>\u003C/ul>\u003C/li><li><a href=\"#hydrateincludeimports\">hydrateIncludeImports\u003C/a>\u003C/li><li><a href=\"#cache\">cache\u003C/a>\u003C/li><li><a href=\"#babelconfig\">babelConfig\u003C/a>\u003C/li><li><a href=\"#translator\">translator\u003C/a>\u003C/li>\u003C/ul>\u003C/li>\u003C/ul>\u003C/li><li><a href=\"#hooks\">Hooks\u003C/a><ul class=\"toc toc-level2\"><li><a href=\"#parse\">Parse\u003C/a>\u003C/li><li><a href=\"#migrate\">Migrate\u003C/a>\u003C/li><li><a href=\"#transform\">Transform\u003C/a>\u003C/li><li><a href=\"#translate\">Translate\u003C/a>\u003C/li>\u003C/ul>\u003C/li><li><a href=\"#utilities\">Utilities\u003C/a>\u003C/li><li><a href=\"#marko-ast\">Marko AST\u003C/a>\u003C/li>\u003C/ul>"}],["s0-1-0-9-9",3,{}],["s0-1-0-9-10",1,{"class":"search"}],["s0-1-0-11-4-208-1",4,{"html":"<pre class=highlighted style=color:#D0D0E0;background-color:#202034><span style=color:#FF4185>import\u003C/span> <span style=color:#FFF066>\"./bar\"\u003C/span>\n<span style=color:#FF4185>import\u003C/span> <span style=color:#FFF066>\"./foo.css\"\u003C/span>;\n<span style=color:#FF4185>import\u003C/span> <span style=color:#FFF066>\"./baz.wasm\"\u003C/span>;\n\n&lt;<span style=color:#FF4185>div\u003C/span>/>\n\u003C/pre>","concise":"<pre class=highlighted style=color:#D0D0E0;background-color:#202034><span style=color:#FF4185>import\u003C/span> <span style=color:#FFF066>\"./bar\"\u003C/span>;\n<span style=color:#FF4185>import\u003C/span> <span style=color:#FFF066>\"./foo.css\"\u003C/span>;\n<span style=color:#FF4185>import\u003C/span> <span style=color:#FFF066>\"./baz.wasm\"\u003C/span>;\n\n<span style=color:#FF4185>div\u003C/span>\n\u003C/pre>"}],["s0-1-0-11-4-280-1",4,{"html":"<pre class=highlighted style=color:#D0D0E0;background-color:#202034>&lt;<span style=color:#FF4185>h1\u003C/span>>Hello!&lt;/<span style=color:#FF4185>h1\u003C/span>>\n\u003C/pre>","concise":"<pre class=highlighted style=color:#D0D0E0;background-color:#202034><span style=color:#FF4185>h1\u003C/span> -- Hello!\n\u003C/pre>"}]],"t":["OIKmBXjW","HkYzEWAp","mFesaajv","07hv1F0+","UUumdCIE"]})</script></body></html>