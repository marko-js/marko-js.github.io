<!doctype html><html lang=en><head><meta charset=UTF-8><title>Marko</title><link rel=icon type=image/png sizes=32x32 href=/assets/bbf6a67c.png><meta name=viewport content="width=device-width, initial-scale=1"><meta name=Description content="Marko is a friendly (and fast!) UI library that makes building web apps fun."><script>
        var scalingBodyFont = false;

        function scaleBodyFont() {
            var height = Math.max(window.outerHeight, window.screen.height);
            document.documentElement.style.fontSize = Math.pow(Math.min(window.innerWidth, height), 0.25)*19+'%';
            scalingBodyFont = false;
        }

        window.addEventListener('resize', function() {
            requestAnimationFrame(scaleBodyFont);
        });

        scaleBodyFont();
    </script><script src="/assets/0.2a9fc028.js" async></script><script src="/assets/2.969a9213.js" async></script><link rel="stylesheet" href="/assets/4852456f.css"></head><body class=docs><!--M#s0-0-0-9--><header data-marko-key="@header s0-0-0-9" class=site-header><div class=content><a href=/ ><img src=/assets/2a0575bc.png class=site-logo></a><div class=stuff><nav class=site-menu><a href=/docs/getting-started/ >docs</a><a href=/try-online>try online</a><a href=https://github.com/marko-js/marko>github</a><!--M^s0-0-0-9-8 s0-0-0-9 8--><form data-marko='{"onclick":"focus s0-0-0-9-8 false","onsubmit":"search s0-0-0-9-8 false"}' class="site-search search"><img src=/assets/b4389f44.png><input data-marko='{"onblur":"shrink s0-0-0-9-8 false","onfocus":"grow s0-0-0-9-8 false"}' data-marko-key="@input s0-0-0-9-8" type=search placeholder="search the docs..."></form><!--M/--></nav><button data-marko='{"onclick":"toggleMenu s0-0-0-9 false"}' class=menu>&#9776;</button></div></div></header><!--M/--><!--M#s0-0-0-10--><div data-marko-key="@sidebar s0-0-0-10" class=doc-sidebar><button data-marko='{"onclick":"hide s0-0-0-10 false"}' class=close>&#10005;</button><h1>Marko <!--M^s0-0-0-10-10 s0-0-0-10 10--><select data-marko='{"onchange":"switchVersion s0-0-0-10-10 false"}'><option value=current selected>5.1.4</option><option value=http://marko-v4.github.io/docs/ >4.x</option><option value=http://v3.markojs.com/docs/ >3.x</option><option value=http://marko-v2.github.io/docs/ >2.x</option></select><!--M/--></h1><!--M^s0-0-0-10-11 s0-0-0-10 11--><form data-marko='{"onclick":"focus s0-0-0-10-11 false","onsubmit":"search s0-0-0-10-11 false"}' class="site-search search"><img src=/assets/b4389f44.png><input data-marko='{"onblur":"shrink s0-0-0-10-11 false","onfocus":"grow s0-0-0-10-11 false"}' data-marko-key="@input s0-0-0-10-11" type=search placeholder="search the docs..."></form><!--M/--><ul class=toc-level0><li class=section><a href=/docs/guides-overview/ >GUIDES</a></li><li><a href=/docs/installing/ >Installing</a></li><li><a href=/docs/getting-started/ >Getting started</a></li><li><a href=/docs/conditionals-and-lists/ >Conditionals and lists</a></li><li><a href=/docs/custom-tags/ >Custom tags</a></li><li><a href=/docs/state/ >State</a></li><li><a href=/docs/styles/ >Styles</a></li><li><a href=/docs/events/ >Events</a></li><li><a href=/docs/body-content/ >Body content</a></li><li><a href=/docs/marko-5-upgrade/ >Marko 5 upgrade</a></li></ul><ul class=toc-level0><li class=section><a href=/docs/tutorials-overview/ >TUTORIALS</a></li><li><a href=/docs/color-picker/ >Color Picker</a></li></ul><ul class=toc-level0><li class=section><a href=/docs/reference-overview/ >REFERENCE</a></li><li><a href=/docs/rendering/ >Rendering</a></li><li><a href=/docs/syntax/ >Syntax</a></li><li><a href=/docs/core-tags/ >Core tags</a></li><li><a href=/docs/class-components/ >Class components</a></li><li><a href=/docs/marko-json/ >marko.json</a></li><li><a class=selected href=/docs/compiler/ >Compiler</a><ul class="toc toc-level1"><li><a href="#compile-api">Compile API</a><ul class="toc toc-level2"><li><a href="#compilerconfigureoptions-compileoptions">compiler.configure()</a></li><li><a href="#compilercompilesrc-string-filename-string-options-compileoptions-promisecompileresult">compiler.compile(): Promise&lt;CompileResult&gt;</a></li><li><a href="#compilercompilesyncsrc-string-filename-string-options-compileoptions-compileresult">compiler.compileSync(): CompileResult</a></li><li><a href="#compilercompilefilefilename-string-options-compileoptions-promisecompileresult">compiler.compileFile(): Promise&lt;CompileResult&gt;</a></li><li><a href="#compilercompilefilesyncfilename-string-options-compileoptions-compileresult">compiler.compileFileSync(): CompileResult</a></li></ul></li><li><a href="#hooks">Hooks</a><ul class="toc toc-level2"><li><a href="#parse">Parse</a></li><li><a href="#migrate">Migrate</a></li><li><a href="#transform">Transform</a></li><li><a href="#translate">Translate</a></li></ul></li><li><a href="#utilities">Utilities</a></li><li><a href="#marko-ast">Marko AST</a></li></ul></li></ul><ul class=toc-level0><li class=section><a href=/docs/bundler-integrations-overview/ >BUNDLER INTEGRATIONS</a></li><li><a href=/docs/webpack/ >Webpack</a></li><li><a href=/docs/rollup/ >Rollup</a></li><li><a href=/docs/lasso/ >Lasso</a></li></ul><ul class=toc-level0><li class=section><a href=/docs/server-integrations-overview/ >SERVER INTEGRATIONS</a></li><li><a href=/docs/express/ >Express</a></li><li><a href=/docs/koa/ >Koa</a></li><li><a href=/docs/http/ >HTTP</a></li><li><a href=/docs/fastify/ >Fastify</a></li></ul><ul class=toc-level0><li class=section><a href=/docs/tooling-overview/ >TOOLING</a></li><li><a href=/docs/editor-plugins/ >Editor plugins</a></li></ul><ul class=toc-level0><li class=section><a href=/docs/articles-overview/ >ARTICLES</a></li><li><a href=/docs/marko-vs-react/ >Marko vs React</a></li><li><a href=/docs/why-is-marko-fast/ >Why is Marko Fast</a></li><li><a href=/docs/10-awesome-marko-features/ >10 Awesome Marko Features</a></li></ul></div><!--M/--><div class=content><div class=doc-layout><div class=doc-container><div class=doc-content><h1 id=compiler><a name=compiler class=anchor href=#compiler><span class=header-link></span></a>Compiler</h1><p>The Marko compiler tries its best to get out of your way and for the most part you will only see references to it in the various Marko ecosystem plugins for tools like webpack, Rollup, and others.</p><p>The compiler also provides a series of hooks you can tap into to bend the Marko language to your will.</p><blockquote class=note><p><strong>Note:</strong> It is best to use existing official plugins, and the standard tag library when possible.</p></blockquote><h2 id=compile-api><a name=compile-api class=anchor href=#compile-api><span class=header-link></span></a>Compile API</h2><p>The compile API is relatively straightforward and always you to take any Marko file and turn it into executable JavaScript.</p><script>if(localStorage.getItem('markojs-website:syntax') === 'concise'){document.body.classList.add('concise')}</script><pre class=highlighted style=color:#E0E0E0;background-color:#282C34>import * as compiler from "@marko/compiler";

type CompileOptions = typeof import("@marko/compiler/src/config.js");

type CompileResult = {
  meta: Record&lt;string, unknown>; // Meta data gathered while compiling.
  map?: SourceMap; // A sourcemap.
  code: string; // The translated code.
};
</pre><h3 id=compilerconfigureoptions-compileoptions><a name=compilerconfigureoptions-compileoptions class=anchor href=#compilerconfigureoptions-compileoptions><span class=header-link></span></a><code>compiler.configure(options: CompileOptions)</code></h3><p>The <code>configure</code> API will override the default compiler options. For the list of options (applicable to all <code>compile*</code> functions) <a href=https://github.com/marko-js/marko/tree/master/packages/compiler/src/config.js>see the source code</a>.</p><pre class=highlighted style=color:#E0E0E0;background-color:#282C34>compiler.<span style=color:#A6E22E>configure</span>({ output: <span style=color:#E6DB74>"dom"</span> });
</pre><h3 id=compilercompilesrc-string-filename-string-options-compileoptions-promisecompileresult><a name=compilercompilesrc-string-filename-string-options-compileoptions-promisecompileresult class=anchor href=#compilercompilesrc-string-filename-string-options-compileoptions-promisecompileresult><span class=header-link></span></a><code>compiler.compile(src: string, filename: string, options?: CompileOptions): Promise&lt;CompileResult&gt;</code></h3><h3 id=compilercompilesyncsrc-string-filename-string-options-compileoptions-compileresult><a name=compilercompilesyncsrc-string-filename-string-options-compileoptions-compileresult class=anchor href=#compilercompilesyncsrc-string-filename-string-options-compileoptions-compileresult><span class=header-link></span></a><code>compiler.compileSync(src: string, filename: string, options?: CompileOptions): CompileResult</code></h3><p>Both the <code>compile</code> and <code>compileSync</code> APIs will translate the provided Marko source code into JavaScript. The only difference between the two (as the names likely suggest) is that <code>compile</code> will use async APIs under the hood while <code>compileSync</code> will use sync APIs.</p><pre class=highlighted style=color:#E0E0E0;background-color:#282C34><span style=color:#66D9EF;font-style:italic>const</span> asyncResult <span style=color:#FFFFFF>=</span> <span style=color:#F92672>await</span> compiler.<span style=color:#A6E22E>compile</span>(
  <span style=color:#E6DB74>"&lt;h1>Hello!&lt;/>"</span>,
  <span style=color:#E6DB74>"./src/index.marko"</span>,
  { modules: <span style=color:#E6DB74>"cjs"</span> }
);
<span style=color:#66D9EF;font-style:italic>const</span> syncResult <span style=color:#FFFFFF>=</span> compiler.<span style=color:#A6E22E>compileSync</span>(<span style=color:#E6DB74>"&lt;h1>Hello!&lt;/>"</span>, <span style=color:#E6DB74>"./src/index.marko"</span>, {
  modules: <span style=color:#E6DB74>"cjs"</span>
});
</pre><h3 id=compilercompilefilefilename-string-options-compileoptions-promisecompileresult><a name=compilercompilefilefilename-string-options-compileoptions-promisecompileresult class=anchor href=#compilercompilefilefilename-string-options-compileoptions-promisecompileresult><span class=header-link></span></a><code>compiler.compileFile(filename: string, options?: CompileOptions): Promise&lt;CompileResult&gt;</code></h3><h3 id=compilercompilefilesyncfilename-string-options-compileoptions-compileresult><a name=compilercompilefilesyncfilename-string-options-compileoptions-compileresult class=anchor href=#compilercompilefilesyncfilename-string-options-compileoptions-compileresult><span class=header-link></span></a><code>compiler.compileFileSync(filename: string, options?: CompileOptions): CompileResult</code></h3><p><code>compileFile</code> and <code>compileFileSync</code> act the same as their counterparts <code>compile</code> and <code>compileSync</code> with the exception being that you do not need to pass in the source content. Instead, these APIs will load the file from disk for you automatically.</p><pre class=highlighted style=color:#E0E0E0;background-color:#282C34><span style=color:#66D9EF;font-style:italic>const</span> asyncResult <span style=color:#FFFFFF>=</span> <span style=color:#F92672>await</span> compiler.<span style=color:#A6E22E>compileFile</span>(<span style=color:#E6DB74>"./src/index.marko"</span>, {
  modules: <span style=color:#E6DB74>"cjs"</span>
});
<span style=color:#66D9EF;font-style:italic>const</span> syncResult <span style=color:#FFFFFF>=</span> compiler.<span style=color:#A6E22E>compileFileSync</span>(<span style=color:#E6DB74>"./src/index.marko"</span>, {
  modules: <span style=color:#E6DB74>"cjs"</span>
});
</pre><h2 id=hooks><a name=hooks class=anchor href=#hooks><span class=header-link></span></a>Hooks</h2><p><img src=/assets/001555ca.png alt="Marko compiler hooks" style=max-width:100%></p><p>The Marko compiler runs through a series of stages to produce the final JavaScript output. These stages are intended for different aspects of processing the template and can be hooked into using <a href=/docs/marko-json/ ><code>marko.json</code></a> configuration.</p><p>All compiler hooks must export a visitor which will receive a <a href=https://github/docs/.com/jamiebuilds/babel-handbook/blob/master/translations/en/plugin-handbook/#paths>babel NodePath</a> with a <code>MarkoTag</code> node.</p><p>The hook will also receive a <code>types</code> object that matches the <a href=https://babeljs.io/docs/en/babel-types>@babel/types</a> API extended with the <a href=#marko-ast>Marko AST types</a>. You can also get a reference to this by importing the <code>@marko/babel-types</code> module.</p><p>Here is an example hook:</p><pre class=highlighted style=color:#E0E0E0;background-color:#282C34><span style=color:#66D9EF;font-style:italic>module</span>.<span style=color:#66D9EF;font-style:italic>exports</span> <span style=color:#FFFFFF>=</span> (<span style=color:#FD971F;font-style:italic>tag</span>, <span style=color:#FD971F;font-style:italic>t</span>) <span style=color:#66D9EF;font-style:italic>=></span> {
  <span style=color:#F92672>if</span> (t.<span style=color:#A6E22E>isStringLiteral</span>(tag.node.name)) {
    console.<span style=color:#A6E22E>log</span>(<span style=color:#E6DB74>`Found a tag called </span><span style=color:#66D9EF>${</span><span style=color:#E6DB74>tag.node.name.value</span><span style=color:#66D9EF>}</span><span style=color:#E6DB74>`</span>);
    tag.<span style=color:#A6E22E>remove</span>();
  }
};
</pre><p>Hooks can also export an <code>enter</code> (alias of <code>default</code>) and an <code>exit</code> function. These map to <a href=https://github/docs/.com/jamiebuilds/babel-handbook/blob/master/translations/en/plugin-handbook/#babel-traverse>@babel/traverse&#39;s</a> <code>enter</code> and <code>exit</code> methods.</p><h3 id=parse><a name=parse class=anchor href=#parse><span class=header-link></span></a>Parse</h3><p>The first step to Marko&#39;s compilation is to take the raw text of your Marko template and convert it into an &quot;Abstract Syntax Tree&quot;. If you&#39;ve not heard the term before, put simply it is just an object representation of your code.</p><!--M#s0-0-0-12-4-75--><div class=marko-code-block><button data-marko='{"onclick":"changeSyntax s0-0-0-12-4-75 false"}' title="Switch Syntax" class=switch-syntax>â‡„</button><div class="code html"><pre class=highlighted style=color:#E0E0E0;background-color:#282C34>&lt;<span style=color:#F92672>h1</span>><span style=color:#E6DB74>Hello!</span>&lt;/<span style=color:#F92672>h1</span>>
</pre></div><div class="code concise"><pre class=highlighted style=color:#E0E0E0;background-color:#282C34><span style=color:#F92672>h1</span> --<span style=color:#E6DB74> Hello!</span>
</pre></div></div><!--M/--><p>Will roughly become</p><pre class=highlighted style=color:#E0E0E0;background-color:#282C34>{
  <span style=color:#E6DB74>"type"</span>: <span style=color:#E6DB74>"MarkoTag"</span>,
  <span style=color:#E6DB74>"name"</span>: {
    <span style=color:#E6DB74>"type"</span>: <span style=color:#E6DB74>"StringLiteral"</span>,
    <span style=color:#E6DB74>"value"</span>: <span style=color:#E6DB74>"h1"</span>
  },
  <span style=color:#E6DB74>"body"</span>: {
    <span style=color:#E6DB74>"type"</span>: <span style=color:#E6DB74>"MarkoTagBody"</span>,
    <span style=color:#E6DB74>"body"</span>: [
      {
        <span style=color:#E6DB74>"type"</span>: <span style=color:#E6DB74>"MarkoText"</span>,
        <span style=color:#E6DB74>"value"</span>: <span style=color:#E6DB74>"Hello!"</span>
      }
    ]
  }
}
</pre><p>This might look a bit verbose, but we are aiming for completeness, not terseness in this output.</p><p>Marko takes a two-step parsing approach to remain flexible with the ever-changing syntax of JavaScript. The first pass of parsing happens in our very own <a href=https://github.com/marko-js/htmljs-parser>htmljs-parser</a>, which understands the HTML parts of your template.</p><p>For JavaScript expressions, Marko defers to <a href=https://babeljs.io/docs/en/babel-parser>@babel/parser</a>. The <a href=#marko-ast>Marko AST</a> above is a superset of what would be returned from <code>@babel/parser</code>.</p><p>To hook into the <code>parse</code> stage you can use the <code>parse</code> option in the <code>marko.json</code> file. The <code>parse</code> hook deviates from the rest of the compiler hooks in that it does not support the <code>enter</code> &amp; <code>exit</code> API and you <em>must return</em> a replacement AST node.</p><h3 id=migrate><a name=migrate class=anchor href=#migrate><span class=header-link></span></a>Migrate</h3><p>That&#39;s right, Marko has _ first-class_ support for migrations. This compiler hook allows for translating outdated APIs into their modern counterparts, leaving the rest of the compilation non the wiser. These migrations run automatically in the background and can be written to disk when users are ready by running the <a href=https://github/docs/.com/marko-js/cli/blob/master/packages/migrate/README/ ><code>@marko/migrate</code> CLI command</a>.</p><p>To hook into the <code>migrate</code> stage you can use the <code>migrate</code> option in the <code>marko.json</code> file.</p><h3 id=transform><a name=transform class=anchor href=#transform><span class=header-link></span></a>Transform</h3><p>The transform stage of the compiler is meant for userland transformations of Marko code, into other Marko code. Think of it like <a href=https://babeljs.io/docs/en/babel-core#transform>babel.transform</a> for Marko templates. At this stage, you are given a fully parsed and migrated AST to do what you will with.</p><p>To hook into the <code>transform</code> stage you can use the <code>transform</code> option in the <code>marko.json</code> file.</p><h3 id=translate><a name=translate class=anchor href=#translate><span class=header-link></span></a>Translate</h3><p>Finally, we have the translation stage. This stage is Marko&#39;s &quot;Rosetta Stone&quot; and is responsible for turning your beautiful Marko code into the optimized JavaScript you&#39;d rather avoid writing.</p><p>To hook into the <code>translate</code> stage you can use the <code>translate</code> option in the <code>marko.json</code> file.</p><h2 id=utilities><a name=utilities class=anchor href=#utilities><span class=header-link></span></a>Utilities</h2><p>The <a href=https://github.com/marko-js/marko/tree/master/packages/babel-types/index.d.ts><code>@marko/babel-utils</code></a> package exposes a handful of utilities for performing various tasks on the <a href=#marko-ast>Marko AST</a>.</p><h2 id=marko-ast><a name=marko-ast class=anchor href=#marko-ast><span class=header-link></span></a>Marko AST</h2><p>You can check out the AST extensions that Marko makes <a href=https://github.com/marko-js/marko/tree/master/packages/babel-types/src/types/definitions.js>in the source code</a>. For AST creation and assertion utilities you can also import Marko&#39;s superset of <code>@babel/types</code> through the <code>@marko/babel-types module</code>.</p><a href=https://github.com/marko-js/marko/blob/master/packages/marko/docs/compiler.md class=edit-on-github>EDIT <img src=/assets/d7fca0b8.svg></a><h2 id=contributors><a name=contributors class=anchor href=#contributors><span class=header-link></span></a> Contributors</h2><p>Helpful? You can thank these awesome people! You can also <a href=https://github.com/marko-js/marko/blob/master/packages/marko/docs/compiler.md>edit this doc</a> if you see any issues or want to improve it.</p><div class=contributors><a href=https://github.com/DylanPiercey class=contributor><img src=https://avatars.githubusercontent.com/u/4985201?v=4 class=photo><span class=name>DylanPiercey</span></a><a href=https://github.com/marko-js/marko/blob/master/packages/marko/docs/compiler.md class="contributor you"><div class=photo><span class=icon>+</span></div><span class=name>You?</span></a></div><footer class="site-footer doc-footer"><a href=https://openjsf.org/  class=openjsf><img src=/assets/f9c991e7.png> <span><span class=bold>OpenJS</span>&nbsp;<span class=light>Foundation</span></span></a><div class=separator></div><a href=https://github.com/marko-js/marko/blob/master/LICENSE class=osi><img src=/assets/07891f9e.png> MIT&nbsp;License</a><div class=separator></div><a href=https://github.com/eBay class=ebay><img src=/assets/bb92c8f9.svg> open&nbsp;source</a></footer></div></div></div></div><script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-66854919-1', 'markojs.com');
    ga('send', 'pageview');
  </script><script src=https://cdn.jsdelivr.net/npm/@widgetbot/crate@3 async>
        new Crate({server:'725013179465203793',channel:'725013179926708226'})
      </script><script>$MC=(window.$MC||[]).concat({"l":1,"w":[["s0-0-0-9",0,{}],["s0-0-0-9-8",1,{"class":"search"}],["s0-0-0-10",2,{"currentDoc":"compiler","toc":"<ul class=\"toc toc-level1\"><li><a href=\"#compile-api\">Compile API\u003C/a><ul class=\"toc toc-level2\"><li><a href=\"#compilerconfigureoptions-compileoptions\">compiler.configure()\u003C/a>\u003C/li><li><a href=\"#compilercompilesrc-string-filename-string-options-compileoptions-promisecompileresult\">compiler.compile(): Promise&lt;CompileResult&gt;\u003C/a>\u003C/li><li><a href=\"#compilercompilesyncsrc-string-filename-string-options-compileoptions-compileresult\">compiler.compileSync(): CompileResult\u003C/a>\u003C/li><li><a href=\"#compilercompilefilefilename-string-options-compileoptions-promisecompileresult\">compiler.compileFile(): Promise&lt;CompileResult&gt;\u003C/a>\u003C/li><li><a href=\"#compilercompilefilesyncfilename-string-options-compileoptions-compileresult\">compiler.compileFileSync(): CompileResult\u003C/a>\u003C/li>\u003C/ul>\u003C/li><li><a href=\"#hooks\">Hooks\u003C/a><ul class=\"toc toc-level2\"><li><a href=\"#parse\">Parse\u003C/a>\u003C/li><li><a href=\"#migrate\">Migrate\u003C/a>\u003C/li><li><a href=\"#transform\">Transform\u003C/a>\u003C/li><li><a href=\"#translate\">Translate\u003C/a>\u003C/li>\u003C/ul>\u003C/li><li><a href=\"#utilities\">Utilities\u003C/a>\u003C/li><li><a href=\"#marko-ast\">Marko AST\u003C/a>\u003C/li>\u003C/ul>"}],["s0-0-0-10-10",3,{}],["s0-0-0-10-11",1,{"class":"search"}],["s0-0-0-12-4-75",4,{"html":"<pre class=highlighted style=color:#E0E0E0;background-color:#282C34>&lt;<span style=color:#F92672>h1\u003C/span>><span style=color:#E6DB74>Hello!\u003C/span>&lt;/<span style=color:#F92672>h1\u003C/span>>\n\u003C/pre>","concise":"<pre class=highlighted style=color:#E0E0E0;background-color:#282C34><span style=color:#F92672>h1\u003C/span> --<span style=color:#E6DB74> Hello!\u003C/span>\n\u003C/pre>"}]],"t":["OIKmBXjW","HkYzEWAp","mFesaajv","07hv1F0+","UUumdCIE"]})</script></body></html>